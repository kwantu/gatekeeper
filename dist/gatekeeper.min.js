(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.GK = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";function GK(){}var getResponse=function(e,t,o,n,s){var r={status:e,name:t,message:o,error:n,model:s};return r};GK.prototype.instantiate=function(e,t,o,n,s){return new Promise(function(r,a){try{if(t==INSTANCE_TYPE_NEW_INS)dao.get(e).done(function(e){var t=getResponse(CONFLICT_CODE,CONFLICT_NAME,"Document with same id already exists.",!0,null),o=[t];a(o)}).fail(function(t){library.saveEntries(o,n,e,s).then(function(e){r(e)},function(e){a(e)})});else if(t==INSTANCE_TYPE_NEW_SEQ)dao.get(e).done(function(t){if(t.model.pending.status==ENTRY_STATUS_AUTHORISED||t.model.pending.status==ENTRY_STATUS_REJECTED){var o=function(e){console.log("newSeq=="+e),t.model.pending.seq=e,t.model.pending.data={},t.model.pending.status=ENTRY_STATUS_INITIALISED,t.model.pending.validDate=s,t.model.pending.revision="";var o={name:LOCAL_SETTINGS.SESSION.firstName+" "+LOCAL_SETTINGS.SESSION.lastName,userId:LOCAL_SETTINGS.SUBSCRIPTIONS.userId,username:LOCAL_SETTINGS.SUBSCRIPTIONS.username};t.model.pending.user=o},n=e+":approved";dao.get(n).done(function(e){var n=JSON.xpath("max(//approved/seq)",ko.toJS(e),{})[0],s=n+1;o(s);var a=getResponse(CREATED_CODE,CREATED_NAME,"Sequence created",!1,t),d=[a];r(d)}).fail(function(e){var t=getResponse(e.status,e.name,"Approved doc not found to create a new sequence",!0,null),o=[t];a(o)})}else{var d=getResponse(SERVER_ERROR_CODE,SERVER_ERROR_NAME,"Cannot create sequence. Current status should be "+ENTRY_STATUS_AUTHORISED+" or "+ENTRY_STATUS_REJECTED,!0,null),l=[d];a(l)}},function(t){library.saveEntries(o,n,e,s).then(function(e){r(e)},function(e){var t=getResponse(e.status,e.name,e.message,!0,null),o=[t];a(o)})});else{var d=getResponse(SERVER_ERROR_CODE,SERVER_ERROR_NAME,"Instance parameter not passed",!0,null),l=[d];a(l)}}catch(e){console.log("catch case "+e),a(e)}})},GK.prototype.instantiateData=function(documentId,instantiateFrom,indicatorModel,seqNo){var _this=this;return new Promise(function(resolve,reject){try{var getResponse=function(e,t,o,n,s){var r={status:e,name:t,message:o,error:n,model:s};return r};dao.get(documentId).done(function(data){if(data.model.pending.status==ENTRY_STATUS_INITIALISED)if(data.model.pending.seq==seqNo)instantiateFrom==FROM_REQUEST?dao.get(documentId).done(function(data){data.model.pending.data[indicatorModel.defaultModel.setId()]=JSON.parse(ko.toJSON(eval("indicatorModel.customModel."+indicatorModel.defaultModel.setId()),function(e,t){return"__ko_mapping__"===e?void 0:void 0==t?"":t})),data.model.pending.status=ENTRY_STATUS_DATA_INITIALISED;var response=getResponse(UPDATED_CODE,UPDATED_NAME,"Document initialised.",!1,data),responseArray=[response];resolve(responseArray)}).fail(function(e){var t=getResponse(e.status,e.name,"Cannot find document "+documentId,!0,null),o=[t];reject(o)}):instantiateFrom==FROM_DEFINITION?dao.get(documentId).done(function(data){var setId=indicatorModel.defaultModel.setId(),version=JSON.xpath("/indicators[setId eq '"+setId+"']/version",app.SCOPE.APP_CONFIG,{}),setModelId=setId+"_"+version+"_ENTRY";dao.get(setModelId).done(function(setModel){var definitionModel=eval("setModel.model.pending.data."+setId);data.model.pending.data[setId]=definitionModel,data.model.pending.status=ENTRY_STATUS_DATA_INITIALISED;var response=getResponse(UPDATED_CODE,UPDATED_NAME,"Document initialised.",!1,data),responseArray=[response];resolve(responseArray)}).fail(function(e){var t=getResponse(e.status,e.name,"Cannot find default model "+setModelId,!0,null),o=[t];reject(o)})}).fail(function(e){var t=getResponse(e.status,e.name,"Cannot find document "+documentId,!0,null),o=[t];reject(o)}):instantiateFrom==FROM_AUTHORISED&&dao.get(documentId).done(function(data){var setId=indicatorModel.defaultModel.setId(),version=JSON.xpath("/indicators[setId eq '"+setId+"']/version",app.SCOPE.APP_CONFIG,{}),approvedModelId=documentId+":approved";dao.get(approvedModelId).done(function(approvedModel){var max_seq=JSON.xpath("max(/model/approved/seq)",approvedModel,{})[0],lastApprovedModel=JSON.xpath("/model/approved[./seq = "+max_seq+"]",approvedModel,{})[0],newModel=eval("lastApprovedModel.data."+setId);data.model.pending.data[setId]=newModel,data.model.pending.status=ENTRY_STATUS_DATA_INITIALISED;var response=getResponse(UPDATED_CODE,UPDATED_NAME,"Document initialised.",!1,data),responseArray=[response];resolve(responseArray)}).fail(function(e){var t=getResponse(e.status,e.name,"Cannot find approved model "+approvedModelId,!0,null),o=[t];reject(o)})}).fail(function(e){var t=getResponse(e.status,e.name,"Cannot find document "+documentId,!0,null),o=[t];reject(o)});else{var response=getResponse(SERVER_ERROR_CODE,SERVER_ERROR_NAME,"Input sequence should be equal to pending sequence.",!0,null),responseArray=[response];reject(responseArray)}else{var response=getResponse(SERVER_ERROR_CODE,SERVER_ERROR_NAME,"Status is not in "+ENTRY_STATUS_INITIALISED+" state.",!0,null),responseArray=[response];reject(responseArray)}}).fail(function(e){var t=getResponse(e.status,e.name,e.message,!0,null),o=[t];reject(o)})}catch(e){reject(e)}})},GK.prototype.update=function(documentId,indicatorModel){var self=this;return new Promise(function(resolve,reject){try{var processAllRules=function(index,object,indicatorModel,configDoc,ruleResponse,def_processRules){var ruleObj=configDoc.rules[index],executeAt=ruleObj.executeAt,id=ruleObj.id,seq=ruleObj.seq,type=ruleObj.executeRule.ruleType;if("local"==executeAt)switch(type){case"update":for(var source=ruleObj.executeRule.params.source,str="",ol=0;ol<ruleObj.executeRule.params.target.length;ol++){var targetItem=ruleObj.executeRule.params.target[ol],targetType=targetItem.type,targetName=targetItem.name;str="variable"==targetType?str+eval("indicatorModel.customModel."+indicatorModel.defaultModel.setId()+"."+targetName+"()")+" ":str+targetName+" "}"doc:"==source.substring(0,4)?eval("object."+source.substring(source.length,4)+"= str;"):eval("object.model.pending.data."+indicatorModel.defaultModel.setId()+"."+source+"= str;"),ruleResponse.ruleStatus="RULE_COMPLETE",index==configDoc.rules.length-1?def_processRules.resolve(ruleResponse):processAllRules(index+1,object,indicatorModel,configDoc,ruleResponse,def_processRules);break;case"initialise":break;case"unique":}else object.model.pending.processingStatus.seq=seq,object.model.pending.processingStatus.ruleStatus=PROCESSING_STATUS_SERVER_RULES,ruleResponse.ruleStatus="RULE_SERVER",def_processRules.resolve(ruleResponse);return def_processRules};dao.get(documentId).done(function(doc){if(indicatorModel.modelErrors().length>0){var response=getResponse(PRECONDITION_FAILED_CODE,PRECONDITION_FAILED_NAME,"There are "+indicatorModel.modelErrors().length+" errors on form. Please resolve first.",!0,null),responseArray=[response];reject(responseArray)}else if(doc.model.pending.status==ENTRY_STATUS_DATA_INITIALISED||doc.model.pending.status==ENTRY_STATUS_UPDATED){var model=JSON.parse(ko.toJSON(eval("indicatorModel.customModel."+indicatorModel.defaultModel.setId()),function(e,t){return"__ko_mapping__"===e?void 0:void 0==t?"":t})),version="";version=indicatorModel.customModel.setId()==PROFILE_SET_ID?"V1.0":JSON.xpath("/indicators[setId eq '"+indicatorModel.customModel.setId()+"']/version",app.SCOPE.APP_CONFIG,{}),dao.get(indicatorModel.customModel.setId()+"_"+version+"_config").done(function(e){if(doc.model.pending.data[indicatorModel.customModel.setId()]=model,void 0!=e.moderation&&1==e.moderation.required&&(doc.control.draft=!0),doc.updated=moment().format(),doc.contributors.push({name:LOCAL_SETTINGS.SESSION.firstName+" "+LOCAL_SETTINGS.SESSION.lastName,userId:LOCAL_SETTINGS.SUBSCRIPTIONS.userId,username:LOCAL_SETTINGS.SUBSCRIPTIONS.username}),doc.model.pending.user={name:LOCAL_SETTINGS.SESSION.firstName+" "+LOCAL_SETTINGS.SESSION.lastName,userId:LOCAL_SETTINGS.SUBSCRIPTIONS.userId,username:LOCAL_SETTINGS.SUBSCRIPTIONS.username},doc.source="remote",void 0!=e.rules&&e.rules.length>0){doc.model.pending.status=ENTRY_STATUS_PENDING_RULES;var t=new $.Deferred;processAllRules(0,doc,indicatorModel,e,{ruleStatus:""},t).done(function(e){if("RULE_COMPLETE"==e.ruleStatus){if(doc.model.pending.processingStatus.seq="",doc.model.pending.processingStatus.ruleStatus="",doc.model.pending.status=ENTRY_STATUS_UPDATED,void 0!=app.processId){var t=JSON.xpath("/processes[subProcessId eq '"+app.processId+"']",doc,{});t.length>0&&(t[0].status=ENTRY_STATUS_READY_TO_SUBMIT)}indicatorModel.defaultModel.atomId(documentId);var o=getResponse(UPDATED_CODE,UPDATED_NAME,"Document updated",!1,doc),n=[o];resolve(n)}else if("RULE_SERVER"==e.ruleStatus){console.log("dependent onserver rule");var o=getResponse(UPDATED_CODE,UPDATED_NAME,"dependent onserver rule",!1,doc),n=[o];resolve(n)}else"RULE_ERROR"==e.ruleStatus&&console.log("rule error from somewhere")}).fail(function(e){reject("processAllRules fail promise case failed")})}else{doc.model.pending.status=ENTRY_STATUS_UPDATED,indicatorModel.defaultModel.atomId(documentId);var o=getResponse(UPDATED_CODE,UPDATED_NAME,"Document updated",!1,doc),n=[o];resolve(n)}}).fail(function(e){var t=getResponse(e.status,e.name,"config file not found.",!0,null),o=[t];reject(o)})}else{var response=getResponse(SERVER_ERROR_CODE,SERVER_ERROR_NAME,"Status is not in "+ENTRY_STATUS_DATA_INITIALISED+" or "+ENTRY_STATUS_UPDATED+" state.",!0,null),responseArray=[response];reject(responseArray)}}).fail(function(e){var t=getResponse(e.status,e.name,e.message,!0,null),o=[t];reject(o)})}catch(e){reject(e)}})},GK.prototype.authorise=function(documentId){var _this=this;return new Promise(function(resolve,reject){try{if(null!=documentId&&void 0!=documentId&&""!=documentId)dao.get(documentId).done(function(data){if(data.model.pending.status==ENTRY_STATUS_UPDATED){var setId=data.category.term,path=data.model.pending,item=eval(path);data.model.pending.status=ENTRY_STATUS_AUTHORISED;var approve_doc_id=documentId+":approved";dao.get(approve_doc_id).done(function(e){e.model.approved.push(item);var t=getResponse(UPDATED_CODE,UPDATED_NAME,"Document Model approved",!1,data),o=getResponse(UPDATED_CODE,UPDATED_NAME,"Approved model incremented",!1,e),n=[t,o];resolve(n)}).fail(function(e){console.log(e)})}else{var response=getResponse(BAD_REQUEST_CODE,BAD_REQUEST_NAME,"Status not in updated state",!0,null),responseArray=[response];reject(responseArray)}}).fail(function(e){var t=getResponse(e.status,e.name,e.message,!0,null),o=[t];reject(o)});else{var response=getResponse(BAD_REQUEST_CODE,BAD_REQUEST_NAME,"Document ID is blank",!0,null),responseArray=[response];reject(responseArray)}}catch(e){reject(e)}})},GK.prototype.reject=function(documentId){var _this=this;return new Promise(function(resolve,reject){try{if(null!=documentId&&void 0!=documentId&&""!=documentId)dao.get(documentId).done(function(data){if(data.model.pending.status==ENTRY_STATUS_UPDATED){var setId=data.category.term,item=eval("data.model.pending.data"+setId);data.model.pending.status=ENTRY_STATUS_REJECTED;var rejected_doc_id=documentId+":rejected";dao.get(rejected_doc_id).done(function(e){e.model.rejected.push(item);var t=getResponse(UPDATED_CODE,UPDATED_NAME,"Document Model approved",!1,data),o=getResponse(UPDATED_CODE,UPDATED_NAME,"Rejetced model incremented",!1,e),n=[t,o];resolve(n)}).fail(function(e){console.log(e)})}else{var response=getResponse(BAD_REQUEST_CODE,BAD_REQUEST_NAME,"Status not in updated state",!0,null),responseArray=[response];reject(responseArray)}}).fail(function(e){var t=getResponse(e.status,e.name,e.message,!0,null),o=[t];reject(o)});else{var response=getResponse(BAD_REQUEST_CODE,BAD_REQUEST_NAME,"Document ID is blank",!0,null),responseArray=[response];reject(responseArray)}}catch(e){reject(e)}})};var processInitialiseRule=function(e,t,o){},processUniqueRule=function(e,t,o){};GK.prototype.unlock=function(e){return new Promise(function(e,t){})},GK.prototype.persist=function(e){return new Promise(function(t,o){try{for(var n=0;n<e.length;n++)dao.save(e[n].model).done(function(e){console.log(e),t(e)}).fail(function(e){console.log(e),o(e)})}catch(e){o(e)}})},module.exports=GK;

},{}]},{},[1])(1)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL1VzZXJzL0hhc2FuL0FwcERhdGEvUm9hbWluZy9ucG0vbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsImluZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUEsWUFzQkEsU0FBUyxPQUtULEdBQUksYUFBYyxTQUFTLEVBQVEsRUFBTSxFQUFTLEVBQU8sR0FFckQsR0FBSSxJQUNBLE9BQVEsRUFDUixLQUFNLEVBQ04sUUFBUyxFQUNULE1BQU8sRUFDUCxNQUFPLEVBRVgsT0FBTyxHQTBCWCxJQUFHLFVBQVUsWUFBYyxTQUFTLEVBQVksRUFBYyxFQUFPLEVBQVcsR0FHNUUsTUFBTyxJQUFJLFNBQVEsU0FBUyxFQUFTLEdBQ2pDLElBRUksR0FBSSxHQUFnQixzQkFFaEIsSUFBSSxJQUFJLEdBQVksS0FDaEIsU0FBUyxHQUVMLEdBQUksR0FBVyxZQUFZLGNBQWUsY0FBZSx5Q0FBeUMsRUFBTSxNQUVwRyxHQUFpQixFQUVyQixHQUFPLEtBRVIsS0FBSyxTQUFTLEdBRWQsUUFBUSxZQUFZLEVBQU8sRUFBVyxFQUFZLEdBQVcsS0FDNUQsU0FBUyxHQVVMLEVBQVEsSUFFVCxTQUFTLEdBRVIsRUFBTyxXQVFoQixJQUFJLEdBQWdCLHNCQUV2QixJQUFJLElBQUksR0FBWSxLQUNoQixTQUFTLEdBRUwsR0FBSSxFQUFLLE1BQU0sUUFBUSxRQUFVLHlCQUEyQixFQUFLLE1BQU0sUUFBUSxRQUFVLHNCQUF1QixDQUU1RyxHQUFJLEdBQWEsU0FBUyxHQUN0QixRQUFRLElBQUksV0FBYSxHQUN6QixFQUFLLE1BQU0sUUFBUSxJQUFNLEVBQ3pCLEVBQUssTUFBTSxRQUFRLFFBQ25CLEVBQUssTUFBTSxRQUFRLE9BQVMseUJBQzVCLEVBQUssTUFBTSxRQUFRLFVBQVksRUFDL0IsRUFBSyxNQUFNLFFBQVEsU0FBVyxFQUM5QixJQUFJLElBQ0EsS0FBUSxlQUFlLFFBQVEsVUFBWSxJ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QVUsUUFBVSxTQUFTLEdBRzVCLE1BQU8sSUFBSSxTQUFRLFNBQVMsRUFBUyxHQUNqQyxJQUVJLElBQUssR0FBSSxHQUFJLEVBQUcsRUFBSSxFQUFXLE9BQVEsSUFDbkMsSUFBSSxLQUFLLEVBQVcsR0FBRyxPQUFPLEtBQUssU0FBUyxHQUN4QyxRQUFRLElBQUksR0FDWixFQUFRLEtBQ1QsS0FBSyxTQUFTLEdBQ2IsUUFBUSxJQUFJLEdBQ1osRUFBTyxLQUdqQixNQUFPLEdBQ0wsRUFBTyxPQU1uQixPQUFPLFFBQVUiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuLypyZXF1aXJlKCcuL2xpYi9jb25maWcnKTtcclxucmVxdWlyZSgnLi9saWIvbGlicmFyeScpO1xyXG5yZXF1aXJlKCcuL2xpYi9iZXR0ZXJkYXRhLmRhbycpOyovXHJcblxyXG5cclxuLyoqIFxyXG4gKiBSZXByZXNlbnRzIHRoZSBnYXRla2VlcGVyIG1vZHVsZS5cclxuICogVGhpcyBtb2R1bGUgd2lsbCBob2xkIGFsbCBmdW5jdGlvbnMgdG8gYWNjZXNzIGdhdGVrZWVwZXIgdmkgR0soKSBvYmplY3RcclxuICpcclxuICogQGNsYXNzXHJcbiAqIFJldHVybnMgR0soKSBvYmplY3QgXHJcbiAqIEBhdXRob3IgSGFzYW4gQWJiYXNcclxuICogQHZlcnNpb24gMS4wLjBcclxuICpcclxuICogQGV4YW1wbGUgXHJcbiAqIHZhciBnYXRla2VlcGVyID0gbmV3IEdLKCk7XHJcbiAqXHJcbiAqIEByZXR1cm4ge09iamVjdH0gbmV3IEdLIGNvbnN0cnVjdG9yIC8gY2xhc3Mgb2JqZWN0XHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiBHSygpIHtcclxuICAgIC8vXHJcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG59XHJcblxyXG52YXIgZ2V0UmVzcG9uc2UgPSBmdW5jdGlvbihzdGF0dXMsIG5hbWUsIG1lc3NhZ2UsIGVycm9yLCBtb2RlbCkge1xyXG5cclxuICAgIHZhciByZXNwb25zZSA9IHtcclxuICAgICAgICBzdGF0dXM6IHN0YXR1cyxcclxuICAgICAgICBuYW1lOiBuYW1lLFxyXG4gICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UsXHJcbiAgICAgICAgZXJyb3I6IGVycm9yLFxyXG4gICAgICAgIG1vZGVsOiBtb2RlbFxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlc3BvbnNlXHJcblxyXG59XHJcblxyXG4vKiogXHJcbiAqIFJlcHJlc2VudHMgdGhlIGluc3RhbnRpYXRlIGZ1bmN0aW9uLlxyXG4gKiBDcmVhdGVzIG5ldyBkb2N1bWVudCBpbiBjYXNlIG9mIG5ld0luc3RhbmNlLCBhbHNvIGNyZWF0ZXMgYXBwcm92ZWQgYW5kIHJlamVjdGVkIGRvY3VtZW50cy5cclxuICogQ3JlYXRlcyBuZXcgc3VlbmNlIGluIGNhc2Ugb2YgbmV3U2VxdWVuY2UuXHJcbiAqIEBtZXRob2RcclxuICogQHBhcmFtIHtzdHJpbmd9IGRvY3VtZW50SWQgLSBkb2N1bWVudCBpZCB3aGljaCBuZWVkcyB0byBiZSBpbml0aWFsaXNlZFxyXG4gKiBAcGFyYW0ge3N0cmluZ30gaW5zdGFuY2VUeXBlIC0gdmFsdWVkIGNhbiBiZSAobmV3SW5zdGFuY2UvbmV3U2VxdWVuY2UpXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBzZXRJZCAtIHNldElkXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBwcm9maWxlSWQgLSBwcm9maWxlSWRcclxuICogQHBhcmFtIHtzdHJpbmd9IHZhbGlkRGF0ZSAtIHZhbGlkRGF0ZVxyXG4gXHJcbiAqIEBhdXRob3IgSGFzYW4gQWJiYXNcclxuICogQHZlcnNpb24gMS4wLjBcclxuICpcclxuICogQGV4YW1wbGUgXHJcbiAqIHZhciBnYXRla2VlcGVyID0gbmV3IEdLKCk7XHJcbiAqIGdhdGVrZWVlci5pbnN0YW50aWF0ZSgnYWJjMTYxJywnbmV3U2VxdWVuY2UnLCdkZXZlbG9wZXJEZXRhaWwnLDIyLCcyMi8wNC8yMDE2Jyk7XHJcbiAqXHJcbiAqIEByZXR1cm4ge0FycmF5fSBBcnJheSBjb250YWluaW5nIGRvY3VtZW50ICxhcHByb3ZlZCBhbmQgcmVqZWN0ZWQgb2JqZWN0cy5cclxuICpcclxuICovXHJcblxyXG5HSy5wcm90b3R5cGUuaW5zdGFudGlhdGUgPSBmdW5jdGlvbihkb2N1bWVudElkLCBpbnN0YW5jZVR5cGUsIHNldElkLCBwcm9maWxlSWQsIHZhbGlkRGF0ZSkge1xyXG5cclxuICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgdHJ5IHtcclxuXHJcbiAgICAgICAgICAgIGlmIChpbnN0YW5jZVR5cGUgPT0gSU5TVEFOQ0VfVFlQRV9ORVdfSU5TKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgZGFvLmdldChkb2N1bWVudElkKS5kb25lKFxyXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGRhdGEpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IGdldFJlc3BvbnNlKENPTkZMSUNUX0NPREUsIENPTkZMSUNUX05BTUUsICdEb2N1bWVudCB3aXRoIHNhbWUgaWQgYWxyZWFkeSBleGlzdHMuJywgdHJ1ZSwgbnVsbCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2VBcnJheSA9IFtyZXNwb25zZV07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QocmVzcG9uc2VBcnJheSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeS5zYXZlRW50cmllcyhzZXRJZCwgcHJvZmlsZUlkLCBkb2N1bWVudElkLCB2YWxpZERhdGUpLnRoZW4oXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGRhdGEpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAvKiAvLyBUYWtlbiBmcm9tIG9sZCBzZXJ2aWNlSW1wbCA6IFRPRE86IHJldmlld1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoc2V0SWQgPT0gUFJPRklMRV9TRVRfSUQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VydmljZS5jcmVhdGVQcm9maWxlRG9jdW1lbnRzKExPQ0FMX1NFVFRJTkdTLkNPTU1VTklUWV9DT05GSUcuY29tbXVuaXR5SWQsIGRvY3VtZW50SWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlLmFkZFRvTG9jYWxSZWdpc3RyeSh7XCJ1dWlkXCI6ZG9jdW1lbnRJZCxcInNldElkXCI6c2V0SWQsXCJhcHBsaWNhdGlvbklkXCI6YXBwLlNDT1BFLmFwcGxpY2F0aW9uSWQsIFwicHJvZmlsZUlkXCI6YXBwLlNDT1BFLnByb2ZpbGVJZH0pOyBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGRhdGEpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGluc3RhbmNlVHlwZSA9PSBJTlNUQU5DRV9UWVBFX05FV19TRVEpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBkYW8uZ2V0KGRvY3VtZW50SWQpLmRvbmUoXHJcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oZGF0YSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEubW9kZWwucGVuZGluZy5zdGF0dXMgPT0gRU5UUllfU1RBVFVTX0FVVEhPUklTRUQgfHwgZGF0YS5tb2RlbC5wZW5kaW5nLnN0YXR1cyA9PSBFTlRSWV9TVEFUVVNfUkVKRUNURUQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2F2ZU5ld1NlcSA9IGZ1bmN0aW9uKG5ld1NlcSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCduZXdTZXE9PScgKyBuZXdTZXEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEubW9kZWwucGVuZGluZy5zZXEgPSBuZXdTZXE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5tb2RlbC5wZW5kaW5nLmRhdGEgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLm1vZGVsLnBlbmRpbmcuc3RhdHVzID0gRU5UUllfU1RBVFVTX0lOSVRJQUxJU0VEO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEubW9kZWwucGVuZGluZy52YWxpZERhdGUgPSB2YWxpZERhdGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5tb2RlbC5wZW5kaW5nLnJldmlzaW9uID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVzZXIgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBMT0NBTF9TRVRUSU5HUy5TRVNTSU9OLmZpcnN0TmFtZSArIFwiIFwiICsgTE9DQUxfU0VUVElOR1MuU0VTU0lPTi5sYXN0TmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ1c2VySWRcIjogTE9DQUxfU0VUVElOR1MuU1VCU0NSSVBUSU9OUy51c2VySWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidXNlcm5hbWVcIjogTE9DQUxfU0VUVElOR1MuU1VCU0NSSVBUSU9OUy51c2VybmFtZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5tb2RlbC5wZW5kaW5nLnVzZXIgPSB1c2VyO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhcHByb3ZlX2RvY19pZCA9IGRvY3VtZW50SWQgKyAnOmFwcHJvdmVkJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGFvLmdldChhcHByb3ZlX2RvY19pZCkuZG9uZShmdW5jdGlvbihhcHByb3ZlZERhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2VxID0gSlNPTi54cGF0aChcIm1heCgvL2FwcHJvdmVkL3NlcSlcIiwga28udG9KUyhhcHByb3ZlZERhdGEpLCB7fSlbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5ld19zZXEgPSBzZXEgKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVOZXdTZXEobmV3X3NlcSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtYWluUmVzID0gZ2V0UmVzcG9uc2UoQ1JFQVRFRF9DT0RFLCBDUkVBVEVEX05BTUUsICdTZXF1ZW5jZSBjcmVhdGVkJywgZmFsc2UsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZUFycmF5ID0gW21haW5SZXNdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2VBcnJheSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpIHtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtYWluUmVzID0gZ2V0UmVzcG9uc2UoZXJyLnN0YXR1cywgZXJyLm5hbWUsICdBcHByb3ZlZCBkb2Mgbm90IGZvdW5kIHRvIGNyZWF0ZSBhIG5ldyBzZXF1ZW5jZScsIHRydWUsIG51bGwpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2VBcnJheSA9IFttYWluUmVzXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3BvbnNlQXJyYXkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBnZXRSZXNwb25zZShTRVJWRVJfRVJST1JfQ09ERSwgU0VSVkVSX0VSUk9SX05BTUUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0Nhbm5vdCBjcmVhdGUgc2VxdWVuY2UuIEN1cnJlbnQgc3RhdHVzIHNob3VsZCBiZSAnICsgRU5UUllfU1RBVFVTX0FVVEhPUklTRUQgKyAnIG9yICcgKyBFTlRSWV9TVEFUVVNfUkVKRUNURUQsIHRydWUsIG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlQXJyYXkgPSBbcmVzcG9uc2VdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3BvbnNlQXJyYXkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2NyZWF0ZSBkb2N1bWVudCByZWxhdGluZyB0byBuZXcgc2VxXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnkuc2F2ZUVudHJpZXMoc2V0SWQsIHByb2ZpbGVJZCwgZG9jdW1lbnRJZCwgdmFsaWREYXRlKS50aGVuKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IGdldFJlc3BvbnNlKGVyci5zdGF0dXMsIGVyci5uYW1lLCBlcnIubWVzc2FnZSwgdHJ1ZSwgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlQXJyYXkgPSBbcmVzcG9uc2VdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXNwb25zZUFycmF5KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBnZXRSZXNwb25zZShTRVJWRVJfRVJST1JfQ09ERSwgU0VSVkVSX0VSUk9SX05BTUUsICdJbnN0YW5jZSBwYXJhbWV0ZXIgbm90IHBhc3NlZCcsIHRydWUsIG51bGwpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlQXJyYXkgPSBbcmVzcG9uc2VdO1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KHJlc3BvbnNlQXJyYXkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjYXRjaCBjYXNlICcrZXJyKTtcclxuICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcblxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuXHJcbn07XHJcblxyXG5cclxuXHJcbi8qKiBcclxuICogUmVwcmVzZW50cyB0aGUgaW5zdGFudGlhdGVEYXRhIGZ1bmN0aW9uLlxyXG4gKlxyXG4gKiBAbWV0aG9kXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBkb2N1bWVudElkIC0gZG9jdW1lbnQgaWQgd2hpY2ggbmVlZHMgdG8gYmUgaW5pdGlhbGlzZWRcclxuICogQHBhcmFtIHtzdHJpbmd9IGluc3RhbmNlVHlwZSAtIHZhbHVlZCBjYW4gYmUgKG5ld0luc3RhbmNlL25ld1NlcXVlbmNlKVxyXG4gKiBAcGFyYW0ge3N0cmluZ30gaW5zdGFudGlhdGVGcm9tIC0gdmFsdWVkIGNhbiBiZSAoZnJvbVJlcXVlc3QvZnJvbURlZmluaXRpb24vZnJvbUF1dGhvcmlzZWQpXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBpbmRpY2F0b3JNb2RlbCAtIHZpZXdNb2RlbCBvZiBpbmRpY2F0b3JcclxuICogQHBhcmFtIHtudW1iZXJ9IHNlcU5vIC0gU2VxdWVuY2UgbnVtYmVyIHRoYXQgbmVlZHMgdG8gYmUgaW5pdGlhbGlzZWQuXHJcbiBcclxuIFxyXG4gKiBAYXV0aG9yIEhhc2FuIEFiYmFzXHJcbiAqIEB2ZXJzaW9uIDEuMC4wXHJcbiAqXHJcbiAqIEBleGFtcGxlIFxyXG4gKiB2YXIgZ2F0ZWtlZXBlciA9IG5ldyBHSygpO1xyXG4gKiBnYXRla2VlZXIuaW5zdGFudGlhdGVEYXRhKCdhYmMxNjEnLCduZXdTZXF1ZW5jZScsJ2Zyb21BdXRob3Jpc2VkJyx2aWV3TW9kZWwsMSlcclxuICpcclxuICogQHJldHVybiB7QXJyYXl9IEFycmF5IGNvbnRhaW5pbmcgZG9jdW1lbnQgb2JqZWN0LlxyXG4gKlxyXG4gKi9cclxuR0sucHJvdG90eXBlLmluc3RhbnRpYXRlRGF0YSA9IGZ1bmN0aW9uKGRvY3VtZW50SWQsIGluc3RhbnRpYXRlRnJvbSwgaW5kaWNhdG9yTW9kZWwsIHNlcU5vKSB7XHJcblxyXG4gICAgLy9mcm9tIDogMSAtIGlucHV0XHJcbiAgICAvL2Zyb20gOiAyIC0gZGVmaW5pdGlvblxyXG4gICAgLy9mcm9tIDogMyAtIGF1dGhvcmlzZWRcclxuICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgdHJ5IHtcclxuXHJcbiAgICAgICAgICAgIHZhciBnZXRSZXNwb25zZSA9IGZ1bmN0aW9uKHN0YXR1cywgbmFtZSwgbWVzc2FnZSwgZXJyb3IsIG1vZGVsKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogc3RhdHVzLFxyXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IG5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogbWVzc2FnZSxcclxuICAgICAgICAgICAgICAgICAgICBlcnJvcjogZXJyb3IsXHJcbiAgICAgICAgICAgICAgICAgICAgbW9kZWw6IG1vZGVsXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZGFvLmdldChkb2N1bWVudElkKS5kb25lKFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24oZGF0YSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5tb2RlbC5wZW5kaW5nLnN0YXR1cyA9PSBFTlRSWV9TVEFUVVNfSU5JVElBTElTRUQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLm1vZGVsLnBlbmRpbmcuc2VxID09IHNlcU5vKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluc3RhbnRpYXRlRnJvbSA9PSBGUk9NX1JFUVVFU1QpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGFvLmdldChkb2N1bWVudElkKS5kb25lKGZ1bmN0aW9uKGRhdGEpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEubW9kZWwucGVuZGluZy5kYXRhW2luZGljYXRvck1vZGVsLmRlZmF1bHRNb2RlbC5zZXRJZCgpXSA9IEpTT04ucGFyc2Uoa28udG9KU09OKGV2YWwoJ2luZGljYXRvck1vZGVsLmN1c3RvbU1vZGVsLicgKyBpbmRpY2F0b3JNb2RlbC5kZWZhdWx0TW9kZWwuc2V0SWQoKSksIGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICdfX2tvX21hcHBpbmdfXycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLm1vZGVsLnBlbmRpbmcuc3RhdHVzID0gRU5UUllfU1RBVFVTX0RBVEFfSU5JVElBTElTRUQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IGdldFJlc3BvbnNlKFVQREFURURfQ09ERSwgVVBEQVRFRF9OQU1FLCAnRG9jdW1lbnQgaW5pdGlhbGlzZWQuJywgZmFsc2UsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2VBcnJheSA9IFtyZXNwb25zZV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2VBcnJheSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24oZXJyKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBnZXRSZXNwb25zZShlcnIuc3RhdHVzLCBlcnIubmFtZSwgJ0Nhbm5vdCBmaW5kIGRvY3VtZW50ICcgKyBkb2N1bWVudElkLCB0cnVlLCBudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlQXJyYXkgPSBbcmVzcG9uc2VdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QocmVzcG9uc2VBcnJheSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaW5zdGFudGlhdGVGcm9tID09IEZST01fREVGSU5JVElPTikge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYW8uZ2V0KGRvY3VtZW50SWQpLmRvbmUoZnVuY3Rpb24oZGF0YSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNldElkID0gaW5kaWNhdG9yTW9kZWwuZGVmYXVsdE1vZGVsLnNldElkKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2ZXJzaW9uID0gSlNPTi54cGF0aChcIi9pbmRpY2F0b3JzW3NldElkIGVxICdcIiArIHNldElkICsgXCInXS92ZXJzaW9uXCIsIGFwcC5TQ09QRS5BUFBfQ09ORklHLCB7fSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzZXRNb2RlbElkID0gc2V0SWQgKyAnXycgKyB2ZXJzaW9uICsgJ19FTlRSWSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhby5nZXQoc2V0TW9kZWxJZCkuZG9uZShmdW5jdGlvbihzZXRNb2RlbCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkZWZpbml0aW9uTW9kZWwgPSBldmFsKCdzZXRNb2RlbC5tb2RlbC5wZW5kaW5nLmRhdGEuJyArIHNldElkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEubW9kZWwucGVuZGluZy5kYXRhW3NldElkXSA9IGRlZmluaXRpb25Nb2RlbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEubW9kZWwucGVuZGluZy5zdGF0dXMgPSBFTlRSWV9TVEFUVVNfREFUQV9JTklUSUFMSVNFRDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBnZXRSZXNwb25zZShVUERBVEVEX0NPREUsIFVQREFURURfTkFNRSwgJ0RvY3VtZW50IGluaXRpYWxpc2VkLicsIGZhbHNlLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZUFycmF5ID0gW3Jlc3BvbnNlXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2VBcnJheSk7XHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24oZXJyKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gZ2V0UmVzcG9uc2UoZXJyLnN0YXR1cywgZXJyLm5hbWUsICdDYW5ub3QgZmluZCBkZWZhdWx0IG1vZGVsICcgKyBzZXRNb2RlbElkLCB0cnVlLCBudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZUFycmF5ID0gW3Jlc3BvbnNlXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXNwb25zZUFycmF5KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IGdldFJlc3BvbnNlKGVyci5zdGF0dXMsIGVyci5uYW1lLCAnQ2Fubm90IGZpbmQgZG9jdW1lbnQgJyArIGRvY3VtZW50SWQsIHRydWUsIG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2VBcnJheSA9IFtyZXNwb25zZV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXNwb25zZUFycmF5KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpbnN0YW50aWF0ZUZyb20gPT0gRlJPTV9BVVRIT1JJU0VEKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhby5nZXQoZG9jdW1lbnRJZCkuZG9uZShmdW5jdGlvbihkYXRhKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2V0SWQgPSBpbmRpY2F0b3JNb2RlbC5kZWZhdWx0TW9kZWwuc2V0SWQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZlcnNpb24gPSBKU09OLnhwYXRoKFwiL2luZGljYXRvcnNbc2V0SWQgZXEgJ1wiICsgc2V0SWQgKyBcIiddL3ZlcnNpb25cIiwgYXBwLlNDT1BFLkFQUF9DT05GSUcsIHt9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFwcHJvdmVkTW9kZWxJZCA9IGRvY3VtZW50SWQgKyAnOmFwcHJvdmVkJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGFvLmdldChhcHByb3ZlZE1vZGVsSWQpLmRvbmUoZnVuY3Rpb24oYXBwcm92ZWRNb2RlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1heF9zZXEgPSBKU09OLnhwYXRoKCdtYXgoL21vZGVsL2FwcHJvdmVkL3NlcSknLCBhcHByb3ZlZE1vZGVsLCB7fSlbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGFzdEFwcHJvdmVkTW9kZWwgPSBKU09OLnhwYXRoKCcvbW9kZWwvYXBwcm92ZWRbLi9zZXEgPSAnICsgbWF4X3NlcSArICddJywgYXBwcm92ZWRNb2RlbCwge30pWzBdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXdNb2RlbCA9IGV2YWwoJ2xhc3RBcHByb3ZlZE1vZGVsLmRhdGEuJyArIHNldElkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEubW9kZWwucGVuZGluZy5kYXRhW3NldElkXSA9IG5ld01vZGVsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5tb2RlbC5wZW5kaW5nLnN0YXR1cyA9IEVOVFJZX1NUQVRVU19EQVRBX0lOSVRJQUxJU0VEO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IGdldFJlc3BvbnNlKFVQREFURURfQ09ERSwgVVBEQVRFRF9OQU1FLCAnRG9jdW1lbnQgaW5pdGlhbGlzZWQuJywgZmFsc2UsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlQXJyYXkgPSBbcmVzcG9uc2VdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZUFycmF5KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24oZXJyKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gZ2V0UmVzcG9uc2UoZXJyLnN0YXR1cywgZXJyLm5hbWUsICdDYW5ub3QgZmluZCBhcHByb3ZlZCBtb2RlbCAnICsgYXBwcm92ZWRNb2RlbElkLCB0cnVlLCBudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZUFycmF5ID0gW3Jlc3BvbnNlXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXNwb25zZUFycmF5KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IGdldFJlc3BvbnNlKGVyci5zdGF0dXMsIGVyci5uYW1lLCAnQ2Fubm90IGZpbmQgZG9jdW1lbnQgJyArIGRvY3VtZW50SWQsIHRydWUsIG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2VBcnJheSA9IFtyZXNwb25zZV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXNwb25zZUFycmF5KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gZ2V0UmVzcG9uc2UoU0VSVkVSX0VSUk9SX0NPREUsIFNFUlZFUl9FUlJPUl9OQU1FLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdJbnB1dCBzZXF1ZW5jZSBzaG91bGQgYmUgZXF1YWwgdG8gcGVuZGluZyBzZXF1ZW5jZS4nLCB0cnVlLCBudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZUFycmF5ID0gW3Jlc3BvbnNlXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXNwb25zZUFycmF5KTtcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gZ2V0UmVzcG9uc2UoU0VSVkVSX0VSUk9SX0NPREUsIFNFUlZFUl9FUlJPUl9OQU1FLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1N0YXR1cyBpcyBub3QgaW4gJyArIEVOVFJZX1NUQVRVU19JTklUSUFMSVNFRCArICcgc3RhdGUuJywgdHJ1ZSwgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZUFycmF5ID0gW3Jlc3BvbnNlXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3BvbnNlQXJyYXkpO1xyXG5cclxuXHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBnZXRSZXNwb25zZShlcnIuc3RhdHVzLCBlcnIubmFtZSwgZXJyLm1lc3NhZ2UsIHRydWUsIG51bGwpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlQXJyYXkgPSBbcmVzcG9uc2VdO1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KHJlc3BvbnNlQXJyYXkpO1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG5cclxuICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcblxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxufTtcclxuXHJcbi8qKiBcclxuICogUmVwcmVzZW50cyB0aGUgdXBkYXRlIGZ1bmN0aW9uIGZ1bmN0aW9uLlxyXG4gKiBVcGR0YXRlcyB0aGUgY3VycmVudCBkb2N1bWVudCBwZW5kaW5nIHdpdGggaW5wdXQgY3VzdG9tTW9kZWwgb2JqZWN0LlxyXG4gKiBQcm9jZXNzIGFsbCBydWxlcywgYXR0YWNobWVudHMgZXRjLlxyXG4gKiBVcGRhdGVkIHN0YXR1cyB0byBVUERBVEVEIG9yIFBlbmRpbmdSdWxlcyBpZiB0aGVyZSBhcmUgYW55IHNlcnZlciBydWxlc1xyXG4gKiBAbWV0aG9kXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBkb2N1bWVudElkIC0gZG9jdW1lbnQgaWQgd2hpY2ggbmVlZHMgdG8gYmUgaW5pdGlhbGlzZWRcclxuICogQHBhcmFtIHtvYmplY3R9IGluZGljYXRvck1vZGVsIC0gdmlld01vZGVsIG9mIGluZGljYXRvclxyXG5cclxuIFxyXG4gKiBAYXV0aG9yIEhhc2FuIEFiYmFzXHJcbiAqIEB2ZXJzaW9uIDEuMC4wXHJcbiAqXHJcbiAqIEBleGFtcGxlIFxyXG4gKiB2YXIgZ2F0ZWtlZXBlciA9IG5ldyBHSygpO1xyXG4gKiBnYXRla2VlZXIudXBkYXRlKCdhYmMxNjEnLHZpZXdNb2RlbClcclxuICpcclxuICAqIEByZXR1cm4ge0FycmF5fSBBcnJheSBjb250YWluaW5nIGRvY3VtZW50IG9iamVjdC5cclxuICpcclxuICovXHJcblxyXG5HSy5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24oZG9jdW1lbnRJZCwgaW5kaWNhdG9yTW9kZWwpIHtcclxuXHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgdHJ5IHtcclxuXHJcbiAgICAgICAgICAgIHZhciBwcm9jZXNzQWxsUnVsZXMgPVxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24oaW5kZXgsIG9iamVjdCwgaW5kaWNhdG9yTW9kZWwsIGNvbmZpZ0RvYywgcnVsZVJlc3BvbnNlLCBkZWZfcHJvY2Vzc1J1bGVzKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBydWxlT2JqID0gY29uZmlnRG9jLnJ1bGVzW2luZGV4XTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZXhlY3V0ZUF0ID0gcnVsZU9iai5leGVjdXRlQXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkID0gcnVsZU9iai5pZDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc2VxID0gcnVsZU9iai5zZXE7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGUgPSBydWxlT2JqLmV4ZWN1dGVSdWxlLnJ1bGVUeXBlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXhlY3V0ZUF0ID09ICdsb2NhbCcpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAndXBkYXRlJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc291cmNlID0gcnVsZU9iai5leGVjdXRlUnVsZS5wYXJhbXMuc291cmNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdHIgPSAnJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBvbCA9IDA7IG9sIDwgcnVsZU9iai5leGVjdXRlUnVsZS5wYXJhbXMudGFyZ2V0Lmxlbmd0aDsgb2wrKykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhcmdldEl0ZW0gPSBydWxlT2JqLmV4ZWN1dGVSdWxlLnBhcmFtcy50YXJnZXRbb2xdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0VHlwZSA9IHRhcmdldEl0ZW0udHlwZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhcmdldE5hbWUgPSB0YXJnZXRJdGVtLm5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXRUeXBlID09ICd2YXJpYWJsZScpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHIgPSBzdHIgKyBldmFsKFwiaW5kaWNhdG9yTW9kZWwuY3VzdG9tTW9kZWwuXCIgKyBpbmRpY2F0b3JNb2RlbC5kZWZhdWx0TW9kZWwuc2V0SWQoKSArICcuJyArIHRhcmdldE5hbWUgKyAnKCknKSArICcgJztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyID0gc3RyICsgdGFyZ2V0TmFtZSArICcgJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNvdXJjZS5zdWJzdHJpbmcoMCwgNCkgPT0gJ2RvYzonKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2YWwoJ29iamVjdC4nICsgc291cmNlLnN1YnN0cmluZyhzb3VyY2UubGVuZ3RoLCA0KSArICc9IHN0cjsnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmFsKCdvYmplY3QubW9kZWwucGVuZGluZy5kYXRhLicgKyBpbmRpY2F0b3JNb2RlbC5kZWZhdWx0TW9kZWwuc2V0SWQoKSArICcuJyArIHNvdXJjZSArICc9IHN0cjsnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVsZVJlc3BvbnNlLnJ1bGVTdGF0dXMgPSAnUlVMRV9DT01QTEVURSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ID09IGNvbmZpZ0RvYy5ydWxlcy5sZW5ndGggLSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZl9wcm9jZXNzUnVsZXMucmVzb2x2ZShydWxlUmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NBbGxSdWxlcyhpbmRleCArIDEsIG9iamVjdCwgaW5kaWNhdG9yTW9kZWwsIGNvbmZpZ0RvYywgcnVsZVJlc3BvbnNlLCBkZWZfcHJvY2Vzc1J1bGVzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdpbml0aWFsaXNlJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3VuaXF1ZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9UT0RPOiBpbXBsZW1lbnQgc2VydmVyIHNpZGUgcG9zdCBhY3Rpb25zICAgXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QubW9kZWwucGVuZGluZy5wcm9jZXNzaW5nU3RhdHVzLnNlcSA9IHNlcTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0Lm1vZGVsLnBlbmRpbmcucHJvY2Vzc2luZ1N0YXR1cy5ydWxlU3RhdHVzID0gUFJPQ0VTU0lOR19TVEFUVVNfU0VSVkVSX1JVTEVTO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBydWxlUmVzcG9uc2UucnVsZVN0YXR1cyA9ICdSVUxFX1NFUlZFUic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZl9wcm9jZXNzUnVsZXMucmVzb2x2ZShydWxlUmVzcG9uc2UpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZl9wcm9jZXNzUnVsZXM7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBkYW8uZ2V0KGRvY3VtZW50SWQpLmRvbmUoZnVuY3Rpb24oZG9jKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGluZGljYXRvck1vZGVsLm1vZGVsRXJyb3JzKCkubGVuZ3RoID4gMCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBnZXRSZXNwb25zZShQUkVDT05ESVRJT05fRkFJTEVEX0NPREUsIFBSRUNPTkRJVElPTl9GQUlMRURfTkFNRSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ1RoZXJlIGFyZSAnICsgaW5kaWNhdG9yTW9kZWwubW9kZWxFcnJvcnMoKS5sZW5ndGggKyAnIGVycm9ycyBvbiBmb3JtLiBQbGVhc2UgcmVzb2x2ZSBmaXJzdC4nLCB0cnVlLCBudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2VBcnJheSA9IFtyZXNwb25zZV07XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3BvbnNlQXJyYXkpO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZG9jLm1vZGVsLnBlbmRpbmcuc3RhdHVzID09IEVOVFJZX1NUQVRVU19EQVRBX0lOSVRJQUxJU0VEIHx8IGRvYy5tb2RlbC5wZW5kaW5nLnN0YXR1cyA9PSBFTlRSWV9TVEFUVVNfVVBEQVRFRCkge1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtb2RlbCA9IEpTT04ucGFyc2Uoa28udG9KU09OKGV2YWwoJ2luZGljYXRvck1vZGVsLmN1c3RvbU1vZGVsLicgKyBpbmRpY2F0b3JNb2RlbC5kZWZhdWx0TW9kZWwuc2V0SWQoKSksIGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICdfX2tvX21hcHBpbmdfXycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmVyc2lvbiA9ICcnO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGljYXRvck1vZGVsLmN1c3RvbU1vZGVsLnNldElkKCkgPT0gUFJPRklMRV9TRVRfSUQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlcnNpb24gPSAnVjEuMCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uID0gSlNPTi54cGF0aChcIi9pbmRpY2F0b3JzW3NldElkIGVxICdcIiArIGluZGljYXRvck1vZGVsLmN1c3RvbU1vZGVsLnNldElkKCkgKyBcIiddL3ZlcnNpb25cIiwgYXBwLlNDT1BFLkFQUF9DT05GSUcsIHt9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUHJvY2VzcyBhbGwgYXR0YWNobWVudHNcclxuICAgICAgICAgICAgICAgICAgICAgICAgLyp2YXIgZmlsZXMgPSBKU09OLnhwYXRoKFwiLy8qW2ZpbGVEYXRhIGFuZCBpc0NoYW5nZWQgZXEgJ3RydWUnXVwiLG1vZGVsLHt9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRhY2hlbWVudHNUb1Byb2Nlc3MgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcih2YXIgb2w9MDtvbDxmaWxlcy5sZW5ndGg7b2wrKyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZpbGVzT2JqPWZpbGVzW29sXTsgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihmaWxlc09iai5taW1lID09ICdpbWFnZS9qcGVnJyB8fCBmaWxlc09iai5taW1lID09ICdpbWFnZS9wbmcnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dGFjaGVtZW50c1RvUHJvY2Vzcy5wdXNoKHsgXCJkYXRhXCI6IGZpbGVzT2JqLmZpbGVEYXRhLnN1YnN0cmluZyhmaWxlc09iai5maWxlRGF0YS5pbmRleE9mKCdiYXNlNjQnKSs3KSwgXCJpZFwiOiBmaWxlc09iai51dWlkICwgXCJtaW1lXCI6IGZpbGVzT2JqLm1pbWUgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dGFjaGVtZW50c1RvUHJvY2Vzcy5wdXNoKHsgXCJkYXRhXCI6IGZpbGVzT2JqLmZpbGVEYXRhLCBcImlkXCI6IGZpbGVzT2JqLnV1aWQgLCBcIm1pbWVcIjogZmlsZXNPYmoubWltZSB9KTsgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlc09iai5maWxlRGF0YSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZXNPYmouaXNDaGFuZ2VkID0gJ2ZhbHNlJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFsbEZpbGVzID0gSlNPTi54cGF0aChcIi8vKltmaWxlRGF0YSBuZSAnJyBhbmQgdXVpZCBuZSAnJ11cIixtb2RlbCx7fSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IodmFyIG9sPTA7b2w8YWxsRmlsZXMubGVuZ3RoO29sKyspe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsbEZpbGVzW29sXS5maWxlRGF0YSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ICAgXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2F2ZUF0dGFjaG1lbnRzID0gZnVuY3Rpb24oZGF0YSwgbG9vcCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhby5zYXZlQXR0YWNobWVudChkYXRhLmlkLCBkYXRhLnJldiwgYXR0YWNoZW1lbnRzVG9Qcm9jZXNzW2xvb3BdLmRhdGEsIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dGFjaGVtZW50c1RvUHJvY2Vzc1tsb29wXS5taW1lLCBhdHRhY2hlbWVudHNUb1Byb2Nlc3NbbG9vcF0uaWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZG9uZShmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF0dGFjaGVtZW50c1RvUHJvY2Vzcy5sZW5ndGggPiAobG9vcCArIDEpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVBdHRhY2htZW50cyhlLCBsb29wICsgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiY2FuIG5vdCBzYXZlZCBhdHRhY2hlbW50IFwiICsgZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTsqL1xyXG5cclxuXHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZGFvLmdldChpbmRpY2F0b3JNb2RlbC5jdXN0b21Nb2RlbC5zZXRJZCgpICsgJ18nICsgdmVyc2lvbiArIFwiX2NvbmZpZ1wiKS5kb25lKGZ1bmN0aW9uKGNvbmZpZ0RvYykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5tb2RlbC5wZW5kaW5nLmRhdGFbaW5kaWNhdG9yTW9kZWwuY3VzdG9tTW9kZWwuc2V0SWQoKV0gPSBtb2RlbDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2RvYy5tb2RlbC5wZW5kaW5nLnN0YXR1cyA9IEVOVFJZX1NUQVRVU19QRU5ESU5HO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25maWdEb2MubW9kZXJhdGlvbiAhPSB1bmRlZmluZWQgJiYgY29uZmlnRG9jLm1vZGVyYXRpb24ucmVxdWlyZWQgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5jb250cm9sLmRyYWZ0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdGhlIHVwZGF0ZWQgZGF0ZSBmaWVsZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnVwZGF0ZWQgPSBtb21lbnQoKS5mb3JtYXQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgY29udHJpYnV0b3JzIGxpc3RcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5jb250cmlidXRvcnMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IExPQ0FMX1NFVFRJTkdTLlNFU1NJT04uZmlyc3ROYW1lICsgXCIgXCIgKyBMT0NBTF9TRVRUSU5HUy5TRVNTSU9OLmxhc3ROYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidXNlcklkXCI6IExPQ0FMX1NFVFRJTkdTLlNVQlNDUklQVElPTlMudXNlcklkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidXNlcm5hbWVcIjogTE9DQUxfU0VUVElOR1MuU1VCU0NSSVBUSU9OUy51c2VybmFtZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLm1vZGVsLnBlbmRpbmcudXNlciA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogTE9DQUxfU0VUVElOR1MuU0VTU0lPTi5maXJzdE5hbWUgKyBcIiBcIiArIExPQ0FMX1NFVFRJTkdTLlNFU1NJT04ubGFzdE5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ1c2VySWRcIjogTE9DQUxfU0VUVElOR1MuU1VCU0NSSVBUSU9OUy51c2VySWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ1c2VybmFtZVwiOiBMT0NBTF9TRVRUSU5HUy5TVUJTQ1JJUFRJT05TLnVzZXJuYW1lXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNhdmUgdGhlIGRvY3VtZW50IGluIHRoZSBkYXRhYmFzZSBpLmUuIGxvY2FsIFBvdWNoREIgb3IgQ291Y2hiYXNlIExpdGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5zb3VyY2UgPSBcInJlbW90ZVwiO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25maWdEb2MucnVsZXMgIT0gdW5kZWZpbmVkICYmIGNvbmZpZ0RvYy5ydWxlcy5sZW5ndGggPiAwKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5tb2RlbC5wZW5kaW5nLnN0YXR1cyA9IEVOVFJZX1NUQVRVU19QRU5ESU5HX1JVTEVTO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vU3RhcnQgcnVsZSBwcm9jZXNzaW5nIGhlcmUgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGVmX3Byb2Nlc3NSdWxlcyA9IG5ldyAkLkRlZmVycmVkKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0FsbFJ1bGVzKDAsIGRvYywgaW5kaWNhdG9yTW9kZWwsIGNvbmZpZ0RvYywge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInJ1bGVTdGF0dXNcIjogXCJcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGRlZl9wcm9jZXNzUnVsZXMpLmRvbmUoZnVuY3Rpb24oaW5Nb2RlbCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluTW9kZWwucnVsZVN0YXR1cyA9PSAnUlVMRV9DT01QTEVURScpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2MubW9kZWwucGVuZGluZy5wcm9jZXNzaW5nU3RhdHVzLnNlcSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLm1vZGVsLnBlbmRpbmcucHJvY2Vzc2luZ1N0YXR1cy5ydWxlU3RhdHVzID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2MubW9kZWwucGVuZGluZy5zdGF0dXMgPSBFTlRSWV9TVEFUVVNfVVBEQVRFRDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1RPRE86IEZpeCBFTlRSWV9TVEFUVVNfUkVBRFlfVE9fU1VCTUlUIGluIGRvY3VtZW50LiBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhcHAucHJvY2Vzc0lkICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcm9jZXNzID0gSlNPTi54cGF0aChcIi9wcm9jZXNzZXNbc3ViUHJvY2Vzc0lkIGVxICdcIiArIGFwcC5wcm9jZXNzSWQgKyBcIiddXCIsIGRvYywge30pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvY2Vzcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NbMF0uc3RhdHVzID0gRU5UUllfU1RBVFVTX1JFQURZX1RPX1NVQk1JVDsgLy8gY2hlY2sgaGVyZSB0aGUgaW5kZXhcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kaWNhdG9yTW9kZWwuZGVmYXVsdE1vZGVsLmF0b21JZChkb2N1bWVudElkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IGdldFJlc3BvbnNlKFVQREFURURfQ09ERSwgVVBEQVRFRF9OQU1FLCAnRG9jdW1lbnQgdXBkYXRlZCcsIGZhbHNlLCBkb2MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlQXJyYXkgPSBbcmVzcG9uc2VdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZUFycmF5KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaW5Nb2RlbC5ydWxlU3RhdHVzID09ICdSVUxFX1NFUlZFUicpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZGVwZW5kZW50IG9uc2VydmVyIHJ1bGUnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBnZXRSZXNwb25zZShVUERBVEVEX0NPREUsIFVQREFURURfTkFNRSwgJ2RlcGVuZGVudCBvbnNlcnZlciBydWxlJywgZmFsc2UsIGRvYyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2VBcnJheSA9IFtyZXNwb25zZV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlQXJyYXkpO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaW5Nb2RlbC5ydWxlU3RhdHVzID09ICdSVUxFX0VSUk9SJykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdydWxlIGVycm9yIGZyb20gc29tZXdoZXJlJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24oZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KCdwcm9jZXNzQWxsUnVsZXMgZmFpbCBwcm9taXNlIGNhc2UgZmFpbGVkJyk7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2MubW9kZWwucGVuZGluZy5zdGF0dXMgPSBFTlRSWV9TVEFUVVNfVVBEQVRFRDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRpY2F0b3JNb2RlbC5kZWZhdWx0TW9kZWwuYXRvbUlkKGRvY3VtZW50SWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IGdldFJlc3BvbnNlKFVQREFURURfQ09ERSwgVVBEQVRFRF9OQU1FLCAnRG9jdW1lbnQgdXBkYXRlZCcsIGZhbHNlLCBkb2MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZUFycmF5ID0gW3Jlc3BvbnNlXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlQXJyYXkpO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uKGVycikge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IGdldFJlc3BvbnNlKGVyci5zdGF0dXMsIGVyci5uYW1lLCAnY29uZmlnIGZpbGUgbm90IGZvdW5kLicsIHRydWUsIG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlQXJyYXkgPSBbcmVzcG9uc2VdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3BvbnNlQXJyYXkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBnZXRSZXNwb25zZShTRVJWRVJfRVJST1JfQ09ERSwgU0VSVkVSX0VSUk9SX05BTUUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnU3RhdHVzIGlzIG5vdCBpbiAnICsgRU5UUllfU1RBVFVTX0RBVEFfSU5JVElBTElTRUQgKyAnIG9yICcgKyBFTlRSWV9TVEFUVVNfVVBEQVRFRCArICcgc3RhdGUuJywgdHJ1ZSwgbnVsbCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2VBcnJheSA9IFtyZXNwb25zZV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXNwb25zZUFycmF5KTtcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uKGVycikge1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IGdldFJlc3BvbnNlKGVyci5zdGF0dXMsIGVyci5uYW1lLCBlcnIubWVzc2FnZSwgdHJ1ZSwgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2VBcnJheSA9IFtyZXNwb25zZV07XHJcbiAgICAgICAgICAgICAgICByZWplY3QocmVzcG9uc2VBcnJheSk7XHJcblxyXG5cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcblxyXG5cclxufTtcclxuXHJcbi8qKiBcclxuICogUmVwcmVzZW50cyB0aGUgYXV0aG9yaXNlICBmdW5jdGlvbi5cclxuICogVXBkdGF0ZXMgdGhlIGN1cnJlbnQgZG9jdW1lbnQgcGVuZGluZyB3aXRoIHN0YXR1cyBBdXRob3Jpc2VkLlxyXG4gKiBDb3BpZWQgdGhlIGRhdGEgdG8gYXV0aG9yaXNlZCBhcnJheSBvZiBhdXRob3Jpc2VkIGRvY3VtZW50LlxyXG4gKiBAbWV0aG9kXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBkb2N1bWVudElkIC0gZG9jdW1lbnQgaWQgd2hpY2ggbmVlZHMgdG8gYmUgaW5pdGlhbGlzZWRcclxuIFxyXG4gKiBAYXV0aG9yIEhhc2FuIEFiYmFzXHJcbiAqIEB2ZXJzaW9uIDEuMC4wXHJcbiAqXHJcbiAqIEBleGFtcGxlIFxyXG4gKiB2YXIgZ2F0ZWtlZXBlciA9IG5ldyBHSygpO1xyXG4gKiBnYXRla2VlZXIuYXV0aG9yaXNlKCdhYmMxNjEnKVxyXG4gKlxyXG4gICogQHJldHVybiB7QXJyYXl9IEFycmF5IGNvbnRhaW5pbmcgZG9jdW1lbnQgYW5kIGF1dGhvcmlzZSBvYmplY3QuXHJcbiAqXHJcbiAqL1xyXG5cclxuR0sucHJvdG90eXBlLmF1dGhvcmlzZSA9IGZ1bmN0aW9uKGRvY3VtZW50SWQpIHtcclxuXHJcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChkb2N1bWVudElkICE9IG51bGwgJiYgZG9jdW1lbnRJZCAhPSB1bmRlZmluZWQgJiYgZG9jdW1lbnRJZCAhPSAnJykge1xyXG4gICAgICAgICAgICAgICAgZGFvLmdldChkb2N1bWVudElkKS5kb25lKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5tb2RlbC5wZW5kaW5nLnN0YXR1cyA9PSBFTlRSWV9TVEFUVVNfVVBEQVRFRCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2V0SWQgPSBkYXRhLmNhdGVnb3J5LnRlcm07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXRoID0gZGF0YS5tb2RlbC5wZW5kaW5nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IGV2YWwocGF0aCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEubW9kZWwucGVuZGluZy5zdGF0dXMgPSBFTlRSWV9TVEFUVVNfQVVUSE9SSVNFRDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFwcHJvdmVfZG9jX2lkID0gZG9jdW1lbnRJZCArICc6YXBwcm92ZWQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYW8uZ2V0KGFwcHJvdmVfZG9jX2lkKS5kb25lKGZ1bmN0aW9uKGFwcHJvdmVEYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHByb3ZlRGF0YS5tb2RlbC5hcHByb3ZlZC5wdXNoKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1haW5SZXMgPSBnZXRSZXNwb25zZShVUERBVEVEX0NPREUsIFVQREFURURfTkFNRSwgJ0RvY3VtZW50IE1vZGVsIGFwcHJvdmVkJywgZmFsc2UsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFwcHJvdmVSZXMgPSBnZXRSZXNwb25zZShVUERBVEVEX0NPREUsIFVQREFURURfTkFNRSwgJ0FwcHJvdmVkIG1vZGVsIGluY3JlbWVudGVkJywgZmFsc2UsIGFwcHJvdmVEYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZUFycmF5ID0gW21haW5SZXMsIGFwcHJvdmVSZXNdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZUFycmF5KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IGdldFJlc3BvbnNlKEJBRF9SRVFVRVNUX0NPREUsIEJBRF9SRVFVRVNUX05BTUUsICdTdGF0dXMgbm90IGluIHVwZGF0ZWQgc3RhdGUnLCB0cnVlLCBudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlQXJyYXkgPSBbcmVzcG9uc2VdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QocmVzcG9uc2VBcnJheSk7XHJcbiAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IGdldFJlc3BvbnNlKGVyci5zdGF0dXMsIGVyci5uYW1lLCBlcnIubWVzc2FnZSwgdHJ1ZSwgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlQXJyYXkgPSBbcmVzcG9uc2VdO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXNwb25zZUFycmF5KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gZ2V0UmVzcG9uc2UoQkFEX1JFUVVFU1RfQ09ERSwgQkFEX1JFUVVFU1RfTkFNRSwgJ0RvY3VtZW50IElEIGlzIGJsYW5rJywgdHJ1ZSwgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2VBcnJheSA9IFtyZXNwb25zZV07XHJcbiAgICAgICAgICAgICAgICByZWplY3QocmVzcG9uc2VBcnJheSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn07XHJcblxyXG4vKiogXHJcbiAqIFJlcHJlc2VudHMgdGhlIHJlamVjdCAgZnVuY3Rpb24uXHJcbiAqIFVwZHRhdGVzIHRoZSBjdXJyZW50IGRvY3VtZW50IHBlbmRpbmcgd2l0aCBzdGF0dXMgUmVqZXRjZWQuXHJcbiAqIENvcGllZCB0aGUgZGF0YSB0byBhdXRob3Jpc2VkIGFycmF5IG9mIHJlamVjdGVkIGRvY3VtZW50LlxyXG4gKiBAbWV0aG9kXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBkb2N1bWVudElkIC0gZG9jdW1lbnQgaWQgd2hpY2ggbmVlZHMgdG8gYmUgaW5pdGlhbGlzZWRcclxuIFxyXG4gKiBAYXV0aG9yIEhhc2FuIEFiYmFzXHJcbiAqIEB2ZXJzaW9uIDEuMC4wXHJcbiAqXHJcbiAqIEBleGFtcGxlIFxyXG4gKiB2YXIgZ2F0ZWtlZXBlciA9IG5ldyBHSygpO1xyXG4gKiBnYXRla2VlZXIucmVqZWN0KCdhYmMxNjEnKVxyXG4gKlxyXG4gKiBAcmV0dXJuIHtBcnJheX0gQXJyYXkgY29udGFpbmluZyBkb2N1bWVudCBhbmQgcmVqZWN0ZWQgb2JqZWN0LlxyXG4gKlxyXG4gKi9cclxuXHJcbkdLLnByb3RvdHlwZS5yZWplY3QgPSBmdW5jdGlvbihkb2N1bWVudElkKSB7XHJcblxyXG4gICAgdmFyIF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmIChkb2N1bWVudElkICE9IG51bGwgJiYgZG9jdW1lbnRJZCAhPSB1bmRlZmluZWQgJiYgZG9jdW1lbnRJZCAhPSAnJykge1xyXG5cclxuICAgICAgICAgICAgICAgIGRhby5nZXQoZG9jdW1lbnRJZCkuZG9uZShmdW5jdGlvbihkYXRhKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLm1vZGVsLnBlbmRpbmcuc3RhdHVzID09IEVOVFJZX1NUQVRVU19VUERBVEVEKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzZXRJZCA9IGRhdGEuY2F0ZWdvcnkudGVybTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBldmFsKCdkYXRhLm1vZGVsLnBlbmRpbmcuZGF0YScgKyBzZXRJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEubW9kZWwucGVuZGluZy5zdGF0dXMgPSBFTlRSWV9TVEFUVVNfUkVKRUNURUQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZWplY3RlZF9kb2NfaWQgPSBkb2N1bWVudElkICsgJzpyZWplY3RlZCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhby5nZXQocmVqZWN0ZWRfZG9jX2lkKS5kb25lKGZ1bmN0aW9uKHJlamVjdGVkRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0ZWREYXRhLm1vZGVsLnJlamVjdGVkLnB1c2goaXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWFpblJlcyA9IGdldFJlc3BvbnNlKFVQREFURURfQ09ERSwgVVBEQVRFRF9OQU1FLCAnRG9jdW1lbnQgTW9kZWwgYXBwcm92ZWQnLCBmYWxzZSwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVqUmVzID0gZ2V0UmVzcG9uc2UoVVBEQVRFRF9DT0RFLCBVUERBVEVEX05BTUUsICdSZWpldGNlZCBtb2RlbCBpbmNyZW1lbnRlZCcsIGZhbHNlLCByZWplY3RlZERhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlQXJyYXkgPSBbbWFpblJlcywgcmVqUmVzXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2VBcnJheSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uKGVycikge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gZ2V0UmVzcG9uc2UoQkFEX1JFUVVFU1RfQ09ERSwgQkFEX1JFUVVFU1RfTkFNRSwgJ1N0YXR1cyBub3QgaW4gdXBkYXRlZCBzdGF0ZScsIHRydWUsIG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2VBcnJheSA9IFtyZXNwb25zZV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXNwb25zZUFycmF5KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uKGVycikge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBnZXRSZXNwb25zZShlcnIuc3RhdHVzLCBlcnIubmFtZSwgZXJyLm1lc3NhZ2UsIHRydWUsIG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZUFycmF5ID0gW3Jlc3BvbnNlXTtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QocmVzcG9uc2VBcnJheSk7XHJcblxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IGdldFJlc3BvbnNlKEJBRF9SRVFVRVNUX0NPREUsIEJBRF9SRVFVRVNUX05BTUUsICdEb2N1bWVudCBJRCBpcyBibGFuaycsIHRydWUsIG51bGwpXHJcbiAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2VBcnJheSA9IFtyZXNwb25zZV07XHJcbiAgICAgICAgICAgICAgICByZWplY3QocmVzcG9uc2VBcnJheSk7XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcblxyXG5cclxuXHJcbn07XHJcblxyXG52YXIgcHJvY2Vzc0luaXRpYWxpc2VSdWxlID0gZnVuY3Rpb24oZG9jdW1lbnRJZCwgcnVsZU9iaiwgaW5kaWNhdG9yTW9kZWwpIHtcclxuXHJcbn07XHJcblxyXG52YXIgcHJvY2Vzc1VuaXF1ZVJ1bGUgPSBmdW5jdGlvbihkb2N1bWVudElkLCBydWxlT2JqLCBpbmRpY2F0b3JNb2RlbCkge1xyXG5cclxufTtcclxuXHJcbkdLLnByb3RvdHlwZS51bmxvY2sgPSBmdW5jdGlvbih2YWwpIHtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIC8vIFVzZSB0aGUgbmF0aXZlIFByb21pc2UgY29uc3RydWN0b3JcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcblxyXG5cclxuICAgIH0pO1xyXG59O1xyXG5cclxuR0sucHJvdG90eXBlLnBlcnNpc3QgPSBmdW5jdGlvbihtb2RlbEFycmF5KSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIHRyeSB7XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1vZGVsQXJyYXkubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGRhby5zYXZlKG1vZGVsQXJyYXlbaV0ubW9kZWwpLmRvbmUoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufTtcclxuXHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IEdLOyJdfQ==
