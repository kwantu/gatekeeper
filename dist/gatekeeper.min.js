(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.GK = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";function GK(){}var getResponse=function(e,t,o,n,a,s,d){var l={status:e,name:t,message:o,error:n,model:a,approvedModel:s,rejectedModel:d};return l};GK.prototype.instantiate=function(e,t,o,n,a){var s=new $.Deferred;return t==INSTANCE_TYPE_NEW_INS?dao.get(e).done(function(e){var t=getResponse(CONFLICT_CODE,CONFLICT_NAME,"Document with same id already exists",!0,null,null,null);s.reject(t)}).fail(function(t){library.saveEntries(o,n,e,a).done(function(t){o==PROFILE_SET_ID?service.createProfileDocuments(LOCAL_SETTINGS.COMMUNITY_CONFIG.communityId,e):service.addToLocalRegistry({uuid:e,setId:o,applicationId:app.SCOPE.applicationId,profileId:app.SCOPE.profileId}),s.resolve(t)}).fail(function(e){s.reject(e)})}):t==INSTANCE_TYPE_NEW_SEQ?dao.get(e).done(function(t){if(t.model.pending.status==ENTRY_STATUS_AUTHORISED||t.model.pending.status==ENTRY_STATUS_REJECTED){var o=function(e){t.model.pending.seq=e,t.model.pending.data={},t.model.pending.status=ENTRY_STATUS_INITIALISED,t.model.pending.validDate=a,t.model.pending.revision="";var o={name:LOCAL_SETTINGS.SESSION.firstName+" "+LOCAL_SETTINGS.SESSION.lastName,userId:LOCAL_SETTINGS.SUBSCRIPTIONS.userId,username:LOCAL_SETTINGS.SUBSCRIPTIONS.username};t.model.pending.user=o,dao.save(t).done(function(e){s.resolve(t)}).fail(function(e){s.reject(e)})},n=e+":approved";dao.get(n).done(function(e){var t=JSON.xpath("max(//approved/seq)",ko.toJS(e),{})[0],n=t+1;o(n)}).fail(function(e){s.reject(e)})}else{var d=getResponse(SERVER_ERROR_CODE,SERVER_ERROR_NAME,"Cannot create sequence.Current status should be"+ENTRY_STATUS_AUTHORISED+"or "+ENTRY_STATUS_REJECTED,!0,null,null,null);s.resolve(d)}}).fail(function(t){library.saveEntries(o,n,e,a).done(function(e){s.resolve(e)}).fail(function(e){var t=getResponse(e.status,e.name,e.message,!0,null,null,null);s.resolve(t)})}):console.log("instance type not found"),s},GK.prototype.instantiateData=function(documentId,instantiateFrom,indicatorModel,seqNo){var self=this,def=new $.Deferred,getResponse=function(e,t,o,n,a,s,d){var l={status:e,name:t,message:o,error:n,model:a,approvedModel:s,rejectedModel:d};return l},savePacket=function(e){dao.save(e).done(function(e){def.resolve(e)}).fail(function(e){def.reject(e)})};return dao.get(documentId).done(function(data){if(data.model.pending.status==ENTRY_STATUS_INITIALISED)if(data.model.pending.seq==seqNo)instantiateFrom==FROM_REQUEST?dao.get(documentId).done(function(data){data.model.pending.data[indicatorModel.defaultModel.setId()]=JSON.parse(ko.toJSON(eval("indicatorModel.customModel."+indicatorModel.defaultModel.setId()),function(e,t){return"__ko_mapping__"===e?void 0:void 0==t?"":t})),data.model.pending.status=ENTRY_STATUS_DATA_INITIALISED,savePacket(data);var response=getResponse(UPDATED_CODE,UPDATED_NAME,"Document initialised",!1,data,null,null);def.resolve(response)}).fail(function(e){def.reject(e)}):instantiateFrom==FROM_DEFINITION?dao.get(documentId).done(function(data){var setId=indicatorModel.defaultModel.setId(),version=JSON.xpath("/indicators[setId eq '"+setId+"']/version",app.SCOPE.APP_CONFIG,{}),setModelId=setId+"_"+version+"_ENTRY";dao.get(setModelId).done(function(setModel){var definitionModel=eval("setModel.model.pending.data."+setId);data.model.pending.data[setId]=definitionModel,data.model.pending.status=ENTRY_STATUS_DATA_INITIALISED,savePacket(data);var response=getResponse(UPDATED_CODE,UPDATED_NAME,"Document initialised",!1,data,null,null);def.resolve(response)}).fail()}).fail(function(e){def.reject(e)}):instantiateFrom==FROM_AUTHORISED&&dao.get(documentId).done(function(data){var setId=indicatorModel.defaultModel.setId(),version=JSON.xpath("/indicators[setId eq '"+setId+"']/version",app.SCOPE.APP_CONFIG,{}),approvedModelId=documentId+":approved";dao.get(approvedModelId).done(function(approvedModel){var max_seq=JSON.xpath("max(/model/approved/seq)",approvedModel,{})[0],lastApprovedModel=JSON.xpath("/model/approved[./seq = "+max_seq+"]",approvedModel,{})[0],newModel=eval("lastApprovedModel.data."+setId);data.model.pending.data[setId]=newModel,data.model.pending.status=ENTRY_STATUS_DATA_INITIALISED,savePacket(data);var response=getResponse(UPDATED_CODE,UPDATED_NAME,"Document initialised",!1,data,null,null);def.resolve(response)}).fail()}).fail(function(e){def.reject(e)});else{var response=getResponse(SERVER_ERROR_CODE,SERVER_ERROR_NAME,"Input sequence should be equal to pending sequence.",!0,null,null,null);def.resolve(response)}else{var response=getResponse(SERVER_ERROR_CODE,SERVER_ERROR_NAME,"Status is not in "+ENTRY_STATUS_INITIALISED+" state.",!0,null,null,null);def.resolve(response)}}).fail(function(e){var t=getResponse(e.status,e.name,e.message,!0,null,null,null);def.resolve(t)}),def},GK.prototype.update=function(documentId,indicatorModel){var self=this,def=new $.Deferred,processAllRules=function(index,documentId,indicatorModel,configDoc,ruleResponse,def_processRules){var ruleObj=configDoc.rules[index],executeAt=ruleObj.executeAt,id=ruleObj.id,seq=ruleObj.seq,type=ruleObj.executeRule.ruleType;if("local"==executeAt)switch(type){case"update":for(var source=ruleObj.executeRule.params.source,str="",ol=0;ol<ruleObj.executeRule.params.target.length;ol++){var targetItem=ruleObj.executeRule.params.target[ol],targetType=targetItem.type,targetName=targetItem.name;str="variable"==targetType?str+eval("indicatorModel.customModel."+indicatorModel.defaultModel.setId()+"."+targetName+"()")+" ":str+targetName+" "}dao.get(documentId).done(function(object){"doc:"==source.substring(0,4)?eval("object."+source.substring(source.length,4)+"= str;"):eval("object.model.pending.data."+indicatorModel.defaultModel.setId()+"."+source+"= str;"),dao.save(object).done(function(e){ruleResponse.ruleStatus="RULE_COMPLETE",index==configDoc.rules.length-1?def_processRules.resolve(ruleResponse):processAllRules(index+1,documentId,indicatorModel,configDoc,ruleResponse,def_processRules)}).fail(function(e){ruleResponse.ruleStatus="RULE_ERROR"})}).fail(function(e){});break;case"initialise":break;case"unique":}else dao.get(documentId).done(function(e){e.model.pending.processingStatus.seq=seq,e.model.pending.processingStatus.ruleStatus=PROCESSING_STATUS_SERVER_RULES,dao.save(e).done(function(e){ruleResponse.ruleStatus="RULE_SERVER",def_processRules.resolve(ruleResponse)}).fail(function(e){console.log("error function in PROCESSING_STATUS_SERVER_RULES"+e)})}).fail(function(){});return def_processRules};return dao.get(documentId).done(function(doc){if(indicatorModel.modelErrors().length>0){var response=getResponse(PRECONDITION_FAILED_CODE,PRECONDITION_FAILED_NAME,"There are "+indicatorModel.modelErrors().length+" errors on form. Please resolve first.",!0,null,null,null);def.reject(response)}else if(doc.model.pending.status==ENTRY_STATUS_DATA_INITIALISED||doc.model.pending.status==ENTRY_STATUS_UPDATED){var model=JSON.parse(ko.toJSON(eval("indicatorModel.customModel."+indicatorModel.defaultModel.setId()),function(e,t){return"__ko_mapping__"===e?void 0:void 0==t?"":t})),version="";version=indicatorModel.customModel.setId()==PROFILE_SET_ID?"V1.0":JSON.xpath("/indicators[setId eq '"+indicatorModel.customModel.setId()+"']/version",app.SCOPE.APP_CONFIG,{});for(var files=JSON.xpath("//*[fileData and isChanged eq 'true']",model,{}),attachementsToProcess=[],ol=0;ol<files.length;ol++){var filesObj=files[ol];"image/jpeg"==filesObj.mime||"image/png"==filesObj.mime?attachementsToProcess.push({data:filesObj.fileData.substring(filesObj.fileData.indexOf("base64")+7),id:filesObj.uuid,mime:filesObj.mime}):attachementsToProcess.push({data:filesObj.fileData,id:filesObj.uuid,mime:filesObj.mime}),filesObj.fileData="",filesObj.isChanged="false"}for(var allFiles=JSON.xpath("//*[fileData ne '' and uuid ne '']",model,{}),ol=0;ol<allFiles.length;ol++)allFiles[ol].fileData="";var saveAttachments=function(e,t){dao.saveAttachment(e.id,e.rev,attachementsToProcess[t].data,attachementsToProcess[t].mime,attachementsToProcess[t].id).done(function(e){attachementsToProcess.length>t+1&&saveAttachments(e,t+1)}).fail(function(e){console.log("can not saved attachemnt "+e)})},postSave=function(e){indicatorModel.defaultModel.atomId(documentId),attachementsToProcess.length>0&&saveAttachments(e,0);var t=getResponse(UPDATED_CODE,UPDATED_NAME,"Document updated",!1,e,null,null);def.resolve(t)},savePacket=function(e){dao.save(e).done(postSave).fail(function(e){app.showMessage("Unable to save changes due to version conflict. Please reload the form to see the recent updates."),deffered.reject(e)})};dao.get(indicatorModel.customModel.setId()+"_"+version+"_config").done(function(e){doc.model.pending.data[indicatorModel.customModel.setId()]=model,void 0!=e.moderation&&1==e.moderation.required&&(doc.control.draft=!0),doc.updated=moment().format(),doc.contributors.push({name:LOCAL_SETTINGS.SESSION.firstName+" "+LOCAL_SETTINGS.SESSION.lastName,userId:LOCAL_SETTINGS.SUBSCRIPTIONS.userId,username:LOCAL_SETTINGS.SUBSCRIPTIONS.username}),doc.model.pending.user={name:LOCAL_SETTINGS.SESSION.firstName+" "+LOCAL_SETTINGS.SESSION.lastName,userId:LOCAL_SETTINGS.SUBSCRIPTIONS.userId,username:LOCAL_SETTINGS.SUBSCRIPTIONS.username},doc.source="remote",e.rules.length>0?(doc.model.pending.status=ENTRY_STATUS_PENDING_RULES,dao.save(doc).done(function(t){var o=new $.Deferred;processAllRules(0,documentId,indicatorModel,e,{ruleStatus:""},o).done(function(e){"RULE_COMPLETE"==e.ruleStatus?dao.get(documentId).done(function(e){if(e.model.pending.processingStatus.seq="",e.model.pending.processingStatus.ruleStatus="",e.model.pending.status=ENTRY_STATUS_UPDATED,void 0!=app.processId){var t=JSON.xpath("/processes[subProcessId eq '"+app.processId+"']",e,{});t.length>0&&(t[0].status=ENTRY_STATUS_READY_TO_SUBMIT)}savePacket(e)}).fail(function(e){def.reject("ENTRY_STATUS_UPDATED failed")}):"RULE_SERVER"==e.ruleStatus?console.log("dependent onserver rule"):"RULE_ERROR"==e.ruleStatus&&console.log("rule error from somewhere")}).fail(function(e){def.reject("processAllRules fail promise case failed")})}).fail(function(e){def.reject("ENTRY_STATUS_PENDING_RULES failed")})):dao.get(documentId).done(function(e){e.model.pending.status=ENTRY_STATUS_UPDATED,savePacket(e)}).fail(function(e){def.reject("ENTRY_STATUS_UPDATED failed")})}).fail(function(e){var t=getResponse(e.status,e.name,e.message,!0,null,null,null);def.reject(t)})}else{var response=getResponse(SERVER_ERROR_CODE,SERVER_ERROR_NAME,"Status is not in "+ENTRY_STATUS_DATA_INITIALISED+" or "+ENTRY_STATUS_UPDATED+" state.",!0,null,null,null);def.resolve(response)}}).fail(function(e){var t=getResponse(e.status,e.name,e.message,!0,null,null,null);def.reject(t)}),def},GK.prototype.authorise=function(documentId){var self=this,def=new $.Deferred;if(null!=documentId&&void 0!=documentId&&""!=documentId)dao.get(documentId).done(function(data){if(data.model.pending.status==ENTRY_STATUS_UPDATED){var saveDoc=function(e){dao.save(e).done(function(e){}).fail(function(e){def.reject(e)})},setId=data.category.term,path=data.model.pending,item=eval(path);data.model.pending.status=ENTRY_STATUS_AUTHORISED,saveDoc(data);var approve_doc_id=documentId+":approved";dao.get(approve_doc_id).done(function(e){e.model.approved.push(item),saveDoc(e),def.resolve(e)}).fail(function(e){console.log(e)})}else{var response=getResponse(BAD_REQUEST_CODE,BAD_REQUEST_NAME,"Status not in updated state",!0,null,null,null);def.reject(response)}}).fail(function(e){var t=getResponse(e.status,e.name,e.message,!0,null,null,null);def.resolve(t)});else{var response=getResponse(BAD_REQUEST_CODE,BAD_REQUEST_NAME,"Document ID is blank",!0,null,null,null);def.reject(response)}return def},GK.prototype.reject=function(documentId){var self=this,def=new $.Deferred;if(null!=documentId&&void 0!=documentId&&""!=documentId)dao.get(documentId).done(function(data){if(data.model.pending.status==ENTRY_STATUS_UPDATED){var saveDoc=function(e){dao.save(e).done(function(e){}).fail(function(e){def.reject(e)})},setId=data.category.term,item=eval("data.model.pending.data"+setId);data.model.pending.status=ENTRY_STATUS_REJECTED,saveDoc(data);var rejected_doc_id=documentId+":rejected";dao.get(rejected_doc_id).done(function(e){e.model.rejected.push(item),saveDoc(e),def.resolve(e)}).fail(function(e){console.log(e)})}else{var response=getResponse(BAD_REQUEST_CODE,BAD_REQUEST_NAME,"Status not in updated state",!0,null,null,null);def.reject(response)}}).fail(function(e){var t=getResponse(e.status,e.name,e.message,!0,null,null,null);def.resolve(t)});else{var response=getResponse(BAD_REQUEST_CODE,BAD_REQUEST_NAME,"Document ID is blank",!0,null,null,null);def.reject(response)}return def};var processInitialiseRule=function(e,t,o){},processUniqueRule=function(e,t,o){};GK.prototype.unlock=function(e){return new Promise(function(e,t){})},module.exports=GK;

},{}]},{},[1])(1)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Vzci9sb2NhbC9saWIvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsImluZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUEsWUFpQkEsU0FBUyxPQUtULEdBQUksYUFBYyxTQUFTLEVBQVEsRUFBTSxFQUFTLEVBQU8sRUFBTSxFQUFlLEdBRXRFLEdBQUksSUFDZ0IsT0FBUSxFQUNSLEtBQU0sRUFDTixRQUFTLEVBQ1QsTUFBTyxFQUNQLE1BQU8sRUFDUCxjQUFjLEVBQ2QsY0FBYyxFQUVsQyxPQUFRLEdBMEJoQixJQUFHLFVBQVUsWUFBYyxTQUFTLEVBQVksRUFBYyxFQUFPLEVBQVcsR0FFNUUsR0FDSSxHQUFNLEdBQUksR0FBRSxRQWlHaEIsT0EvRkcsSUFBZ0Isc0JBRWYsSUFBSSxJQUFJLEdBQVksS0FDaEIsU0FBUyxHQUVMLEdBQUksR0FBVyxZQUFZLGNBQWUsY0FBYyx3Q0FBdUMsRUFBSyxLQUFLLEtBQUssS0FFOUcsR0FBSSxPQUFPLEtBRVosS0FBSyxTQUFTLEdBRWIsUUFBUSxZQUFZLEVBQU8sRUFBVyxFQUFZLEdBQVcsS0FBSyxTQUFTLEdBS3BFLEdBQVMsZUFFUixRQUFRLHVCQUF1QixlQUFlLGlCQUFpQixZQUFhLEdBRzVFLFFBQVEsb0JBQW9CLEtBQU8sRUFBVyxNQUFRLEVBQU0sY0FBZ0IsSUFBSSxNQUFNLGNBQWUsVUFBWSxJQUFJLE1BQU0sWUFHL0gsRUFBSSxRQUFRLEtBRWIsS0FBSyxTQUFTLEdBRWIsRUFBSSxPQUFPLE9BTWpCLEdBQWdCLHNCQUVyQixJQUFJLElBQUksR0FBWSxLQUNqQixTQUFTLEdBRU4sR0FBRyxFQUFLLE1BQU0sUUFBUSxRQUFVLHlCQUEyQixFQUFLLE1BQU0sUUFBUSxRQUFVLHNCQUF1QixDQUUxRyxHQUFJLEdBQWEsU0FBUyxHQUN2QixFQUFLLE1BQU0sUUFBUSxJQUFNLEVBQ3pCLEVBQUssTUFB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QUVqRCxHQUFJLFNBQVUsU0FBUyxHQUNoQixJQUFJLEtBQUssR0FBSyxLQUNULFNBQVMsTUFJWCxLQUFLLFNBQVMsR0FDWixJQUFJLE9BQU8sTUFLbkIsTUFBUSxLQUFLLFNBQVMsS0FDdEIsS0FBTyxLQUFLLDBCQUEwQixNQUUxQyxNQUFLLE1BQU0sUUFBUSxPQUFTLHNCQUM1QixRQUFRLEtBRVIsSUFBSSxpQkFBa0IsV0FBVyxXQUVqQyxLQUFJLElBQUksaUJBQWlCLEtBQUssU0FBUyxHQUVuQyxFQUFhLE1BQU0sU0FBUyxLQUFLLE1BQ2pDLFFBQVEsR0FHUixJQUFJLFFBQVEsS0FFYixLQUFLLFNBQVMsR0FFYixRQUFRLElBQUksU0FHYixDQUVILEdBQUksVUFBVyxZQUFZLGlCQUFrQixpQkFBaUIsK0JBQThCLEVBQUssS0FBSyxLQUFLLEtBQzNHLEtBQUksT0FBTyxhQU1oQixLQUFLLFNBQVMsR0FFZCxHQUFJLEdBQVcsWUFBWSxFQUFJLE9BQVEsRUFBSSxLQUM5QixFQUFJLFNBQVMsRUFBTSxLQUFNLEtBQU0sS0FDM0MsS0FBSSxRQUFRLFNBSWYsQ0FFRCxHQUFJLFVBQVcsWUFBWSxpQkFBa0IsaUJBQWlCLHdCQUF1QixFQUFLLEtBQUssS0FBSyxLQUVwRyxLQUFJLE9BQU8sVUFJZixNQUFPLEtBSVgsSUFBSSx1QkFBd0IsU0FBUyxFQUFZLEVBQVMsS0FJdEQsa0JBQW9CLFNBQVMsRUFBWSxFQUFTLElBSXRELElBQUcsVUFBVSxPQUFTLFNBQVMsR0FHM0IsTUFBTyxJQUFJLFNBQVEsU0FBUyxFQUFTLE9BT3pDLE9BQU8sUUFBVSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIndXNlIHN0cmljdCc7XG5cbi8qKiBcbiAqIFJlcHJlc2VudHMgdGhlIGdhdGVrZWVwZXIgbW9kdWxlLlxuICogVGhpcyBtb2R1bGUgd2lsbCBob2xkIGFsbCBmdW5jdGlvbnMgdG8gYWNjZXNzIGdhdGVrZWVwZXIgdmkgR0soKSBvYmplY3RcbiAqXG4gKiBAY2xhc3NcbiAqIFJldHVybnMgR0soKSBvYmplY3QgXG4gKiBAYXV0aG9yIEhhc2FuIEFiYmFzXG4gKiBAdmVyc2lvbiAxLjAuMFxuICpcbiAqIEBleGFtcGxlIFxuICogdmFyIGdhdGVrZWVwZXIgPSBuZXcgR0soKTtcbiAqXG4gKiBAcmV0dXJuIHtPYmplY3R9IG5ldyBHSyBjb25zdHJ1Y3RvciAvIGNsYXNzIG9iamVjdFxuICpcbiAqL1xuZnVuY3Rpb24gR0soKXtcblx0Ly9cblx0dmFyIF90aGlzID0gdGhpcztcbn1cblxudmFyIGdldFJlc3BvbnNlID0gZnVuY3Rpb24oc3RhdHVzLCBuYW1lLCBtZXNzYWdlLCBlcnJvciwgbW9kZWwsYXBwcm92ZWRNb2RlbCwgcmVqZWN0ZWRNb2RlbCl7XG5cbiAgICAgICAgdmFyIHJlc3BvbnNlID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogbWVzc2FnZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogZXJyb3IsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWw6IG1vZGVsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcHJvdmVkTW9kZWw6YXBwcm92ZWRNb2RlbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3RlZE1vZGVsOnJlamVjdGVkTW9kZWxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICByZXR1cm4gIHJlc3BvbnNlXG4gICAgXG59XG5cbi8qKiBcbiAqIFJlcHJlc2VudHMgdGhlIGluc3RhbnRpYXRlIGZ1bmN0aW9uLlxuICogQ3JlYXRlcyBuZXcgZG9jdW1lbnQgaW4gY2FzZSBvZiBuZXdJbnN0YW5jZSwgYWxzbyBjcmVhdGVzIGFwcHJvdmVkIGFuZCByZWplY3RlZCBkb2N1bWVudHMuXG4gKiBDcmVhdGVzIG5ldyBzdWVuY2UgaW4gY2FzZSBvZiBuZXdTZXF1ZW5jZS5cbiAqIEBtZXRob2RcbiAqIEBwYXJhbSB7c3RyaW5nfSBkb2N1bWVudElkIC0gZG9jdW1lbnQgaWQgd2hpY2ggbmVlZHMgdG8gYmUgaW5pdGlhbGlzZWRcbiAqIEBwYXJhbSB7c3RyaW5nfSBpbnN0YW5jZVR5cGUgLSB2YWx1ZWQgY2FuIGJlIChuZXdJbnN0YW5jZS9uZXdTZXF1ZW5jZSlcbiAqIEBwYXJhbSB7c3RyaW5nfSBzZXRJZCAtIHNldElkXG4gKiBAcGFyYW0ge3N0cmluZ30gcHJvZmlsZUlkIC0gcHJvZmlsZUlkXG4gKiBAcGFyYW0ge3N0cmluZ30gdmFsaWREYXRlIC0gdmFsaWREYXRlXG4gXG4gKiBAYXV0aG9yIEhhc2FuIEFiYmFzXG4gKiBAdmVyc2lvbiAxLjAuMFxuICpcbiAqIEBleGFtcGxlIFxuICogdmFyIGdhdGVrZWVwZXIgPSBuZXcgR0soKTtcbiAqIGdhdGVrZWVlci5pbnN0YW50aWF0ZSgnYWJjMTYxJywnbmV3U2VxdWVuY2UnLCdkZXZlbG9wZXJEZXRhaWwnLDIyLCcyMi8wNC8yMDE2Jyk7XG4gKlxuICogQHJldHVybiB7T2JqZWN0fSBQcm9taXNlIE9iamVjdCB3aXRoIHJlc3Bvc2UgT2JqZWN0XG4gKlxuICovXG5cbkdLLnByb3RvdHlwZS5pbnN0YW50aWF0ZSA9IGZ1bmN0aW9uKGRvY3VtZW50SWQsIGluc3RhbmNlVHlwZSwgc2V0SWQsIHByb2ZpbGVJZCwgdmFsaWREYXRlKXtcbiAgICBcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIGRlZiA9IG5ldyAkLkRlZmVycmVkKCk7XG5cbiAgICBpZihpbnN0YW5jZVR5cGUgPT0gSU5TVEFOQ0VfVFlQRV9ORVdfSU5TKXtcblxuICAgICAgICBkYW8uZ2V0KGRvY3VtZW50SWQpLmRvbmUoXG4gICAgICAgICAgICBmdW5jdGlvbihkYXRhKXsgXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gZ2V0UmVzcG9uc2UoQ09ORkxJQ1RfQ09ERSwgQ09ORkxJQ1RfTkFNRSwnRG9jdW1lbnQgd2l0aCBzYW1lIGlkIGFscmVhZHkgZXhpc3RzJyx0cnVlLG51bGwsbnVsbCxudWxsIClcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgZGVmLnJlamVjdChyZXNwb25zZSk7XG5cbiAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24oZXJyKXtcblxuICAgICAgICAgICAgICAgIGxpYnJhcnkuc2F2ZUVudHJpZXMoc2V0SWQsIHByb2ZpbGVJZCwgZG9jdW1lbnRJZCwgdmFsaWREYXRlKS5kb25lKGZ1bmN0aW9uKGRhdGEpe1xuXG5cbiAgICAgICAgICAgICAgICAgICAgLy8gVGFrZW4gZnJvbSBvbGQgc2VydmljZUltcGwgOiBUT0RPOiByZXZpZXdcblxuICAgICAgICAgICAgICAgICAgICBpZihzZXRJZCA9PSBQUk9GSUxFX1NFVF9JRClcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VydmljZS5jcmVhdGVQcm9maWxlRG9jdW1lbnRzKExPQ0FMX1NFVFRJTkdTLkNPTU1VTklUWV9DT05GSUcuY29tbXVuaXR5SWQsIGRvY3VtZW50SWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2V7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlLmFkZFRvTG9jYWxSZWdpc3RyeSh7XCJ1dWlkXCI6ZG9jdW1lbnRJZCxcInNldElkXCI6c2V0SWQsXCJhcHBsaWNhdGlvbklkXCI6YXBwLlNDT1BFLmFwcGxpY2F0aW9uSWQsIFwicHJvZmlsZUlkXCI6YXBwLlNDT1BFLnByb2ZpbGVJZH0pOyBcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGRlZi5yZXNvbHZlKGRhdGEpO1xuXG4gICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpe1xuXG4gICAgICAgICAgICAgICAgICAgIGRlZi5yZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgfSBlbHNlIGlmKGluc3RhbmNlVHlwZSA9PSBJTlNUQU5DRV9UWVBFX05FV19TRVEpIHtcblxuICAgICAgICAgZGFvLmdldChkb2N1bWVudElkKS5kb25lKFxuICAgICAgICAgICAgZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICBpZihkYXRhLm1vZGVsLnBlbmRpbmcuc3RhdHVzID09IEVOVFJZX1NUQVRVU19BVVRIT1JJU0VEIHx8IGRhdGEubW9kZWwucGVuZGluZy5zdGF0dXMgPT0gRU5UUllfU1RBVFVTX1JFSkVDVEVEKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHNhdmVOZXdTZXEgPSBmdW5jdGlvbihuZXdTZXEpe1xuICAgICAgICAgICAgICAgICAgICAgICBkYXRhLm1vZGVsLnBlbmRpbmcuc2VxID0gbmV3U2VxO1xuICAgICAgICAgICAgICAgICAgICAgICBkYXRhLm1vZGVsLnBlbmRpbmcuZGF0YSA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICBkYXRhLm1vZGVsLnBlbmRpbmcuc3RhdHVzID0gRU5UUllfU1RBVFVTX0lOSVRJQUxJU0VEO1xuICAgICAgICAgICAgICAgICAgICAgICBkYXRhLm1vZGVsLnBlbmRpbmcudmFsaWREYXRlID0gdmFsaWREYXRlO1xuICAgICAgICAgICAgICAgICAgICAgICBkYXRhLm1vZGVsLnBlbmRpbmcucmV2aXNpb24gPSAnJztcbiAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVzZXI9IHtcIm5hbWVcIjogTE9DQUxfU0VUVElOR1MuU0VTU0lPTi5maXJzdE5hbWUgKyBcIiBcIiArIExPQ0FMX1NFVFRJTkdTLlNFU1NJT04ubGFzdE5hbWUsXCJ1c2VySWRcIjogTE9DQUxfU0VUVElOR1MuU1VCU0NSSVBUSU9OUy51c2VySWQsIFwidXNlcm5hbWVcIjogTE9DQUxfU0VUVElOR1MuU1VCU0NSSVBUSU9OUy51c2VybmFtZX07XG4gICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgIGRhdGEubW9kZWwucGVuZGluZy51c2VyID0gdXNlcjtcbiAgICAgICAgICAgICAgICAgICAgICAgZGFvLnNhdmUoZGF0YSkuZG9uZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbihzKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgKS5mYWlsKGZ1bmN0aW9uKGVycil7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmLnJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIHZhciBhcHByb3ZlX2RvY19pZCA9IGRvY3VtZW50SWQrJzphcHByb3ZlZCdcbiAgICAgICAgICAgICAgICAgICAgZGFvLmdldChhcHByb3ZlX2RvY19pZCkuZG9uZShmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzZXEgPSBKU09OLnhwYXRoKFwibWF4KC8vYXBwcm92ZWQvc2VxKVwiLGtvLnRvSlMoZGF0YSkse30pWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5ld19zZXEgPSBzZXEgKyAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZU5ld1NlcShuZXdfc2VxKTtcblxuICAgICAgICAgICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uKGVycil7XG4gICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmLnJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBnZXRSZXNwb25zZShTRVJWRVJfRVJST1JfQ09ERSwgU0VSVkVSX0VSUk9SX05BTUUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0Nhbm5vdCBjcmVhdGUgc2VxdWVuY2UuQ3VycmVudCBzdGF0dXMgc2hvdWxkIGJlJysgRU5UUllfU1RBVFVTX0FVVEhPUklTRUQgKyAnb3IgJysgRU5UUllfU1RBVFVTX1JFSkVDVEVELCB0cnVlLCBudWxsLCBudWxsLCBudWxsICk7XG4gICAgICAgICAgICAgICAgICAgIGRlZi5yZXNvbHZlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpe1xuICAgICAgICAgICAgICAgIC8vY3JlYXRlIGRvY3VtZW50IHJlbGF0aW5nIHRvIG5ldyBzZXFcbiAgICAgICAgICAgICAgICBsaWJyYXJ5LnNhdmVFbnRyaWVzKHNldElkLCBwcm9maWxlSWQsIGRvY3VtZW50SWQsIHZhbGlkRGF0ZSkuZG9uZShmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgZGVmLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBnZXRSZXNwb25zZShlcnIuc3RhdHVzLCBlcnIubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVyci5tZXNzYWdlLCB0cnVlLCBudWxsLCBudWxsLCBudWxsKTsgXG4gICAgICAgICAgICAgICAgICAgIGRlZi5yZXNvbHZlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG5cbiAgICAgICAgY29uc29sZS5sb2coJ2luc3RhbmNlIHR5cGUgbm90IGZvdW5kJyk7ICAgICAgICAgICAgXG4gICAgXG4gICAgfVxuXG4gICAgcmV0dXJuIGRlZjtcbn07XG5cbi8qKiBcbiAqIFJlcHJlc2VudHMgdGhlIGluc3RhbnRpYXRlRGF0YSBmdW5jdGlvbi5cbiAqXG4gKiBAbWV0aG9kXG4gKiBAcGFyYW0ge3N0cmluZ30gZG9jdW1lbnRJZCAtIGRvY3VtZW50IGlkIHdoaWNoIG5lZWRzIHRvIGJlIGluaXRpYWxpc2VkXG4gKiBAcGFyYW0ge3N0cmluZ30gaW5zdGFuY2VUeXBlIC0gdmFsdWVkIGNhbiBiZSAobmV3SW5zdGFuY2UvbmV3U2VxdWVuY2UpXG4gKiBAcGFyYW0ge3N0cmluZ30gaW5zdGFudGlhdGVGcm9tIC0gdmFsdWVkIGNhbiBiZSAoZnJvbVJlcXVlc3QvZnJvbURlZmluaXRpb24vZnJvbUF1dGhvcmlzZWQpXG4gKiBAcGFyYW0ge29iamVjdH0gaW5kaWNhdG9yTW9kZWwgLSB2aWV3TW9kZWwgb2YgaW5kaWNhdG9yXG4gKiBAcGFyYW0ge251bWJlcn0gc2VxTm8gLSBTZXF1ZW5jZSBudW1iZXIgdGhhdCBuZWVkcyB0byBiZSBpbml0aWFsaXNlZC5cbiBcbiBcbiAqIEBhdXRob3IgSGFzYW4gQWJiYXNcbiAqIEB2ZXJzaW9uIDEuMC4wXG4gKlxuICogQGV4YW1wbGUgXG4gKiB2YXIgZ2F0ZWtlZXBlciA9IG5ldyBHSygpO1xuICogZ2F0ZWtlZWVyLmluc3RhbnRpYXRlRGF0YSgnYWJjMTYxJywnbmV3U2VxdWVuY2UnLCdmcm9tQXV0aG9yaXNlZCcsdmlld01vZGVsLDEpXG4gKlxuICogQHJldHVybiB7T2JqZWN0fSBQcm9taXNlIE9iamVjdCB3aXRoIHJlc3Bvc2UgT2JqZWN0XG4gKlxuICovXG5HSy5wcm90b3R5cGUuaW5zdGFudGlhdGVEYXRhID0gZnVuY3Rpb24oZG9jdW1lbnRJZCwgaW5zdGFudGlhdGVGcm9tLCBpbmRpY2F0b3JNb2RlbCwgc2VxTm8pe1xuXG4gICAgLy9mcm9tIDogMSAtIGlucHV0XG4gICAgLy9mcm9tIDogMiAtIGRlZmluaXRpb25cbiAgICAvL2Zyb20gOiAzIC0gYXV0aG9yaXNlZFxuXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciBkZWYgPSBuZXcgJC5EZWZlcnJlZCgpO1xuXG4gICAgdmFyIGdldFJlc3BvbnNlID0gZnVuY3Rpb24oc3RhdHVzLCBuYW1lLCBtZXNzYWdlLCBlcnJvciwgbW9kZWwsYXBwcm92ZWRNb2RlbCwgcmVqZWN0ZWRNb2RlbCl7XG5cbiAgICAgICAgdmFyIHJlc3BvbnNlID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogbWVzc2FnZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogZXJyb3IsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWw6IG1vZGVsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcHJvdmVkTW9kZWw6YXBwcm92ZWRNb2RlbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3RlZE1vZGVsOnJlamVjdGVkTW9kZWxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICByZXR1cm4gIHJlc3BvbnNlXG4gICAgfVxuXG4gICAgdmFyIHNhdmVQYWNrZXQgPSBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhby5zYXZlKGRhdGEpLmRvbmUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24ocyl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWYucmVzb2x2ZShzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICApLmZhaWwoZnVuY3Rpb24oZXJyKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWYucmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgIGRhby5nZXQoZG9jdW1lbnRJZCkuZG9uZShcbiAgICAgICAgICAgIGZ1bmN0aW9uKGRhdGEpe1xuXG4gICAgICAgICAgICAgICAgaWYoZGF0YS5tb2RlbC5wZW5kaW5nLnN0YXR1cyA9PSBFTlRSWV9TVEFUVVNfSU5JVElBTElTRUQpe1xuXG4gICAgICAgICAgICAgICAgICAgIGlmKGRhdGEubW9kZWwucGVuZGluZy5zZXEgPT0gc2VxTm8pe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihpbnN0YW50aWF0ZUZyb20gPT0gRlJPTV9SRVFVRVNUKXtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhby5nZXQoZG9jdW1lbnRJZCkuZG9uZShmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEubW9kZWwucGVuZGluZy5kYXRhW2luZGljYXRvck1vZGVsLmRlZmF1bHRNb2RlbC5zZXRJZCgpXSA9IEpTT04ucGFyc2Uoa28udG9KU09OKGV2YWwoJ2luZGljYXRvck1vZGVsLmN1c3RvbU1vZGVsLicraW5kaWNhdG9yTW9kZWwuZGVmYXVsdE1vZGVsLnNldElkKCkpLCBmdW5jdGlvbihrZXksIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihrZXkgPT09ICdfX2tvX21hcHBpbmdfXycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLm1vZGVsLnBlbmRpbmcuc3RhdHVzID0gRU5UUllfU1RBVFVTX0RBVEFfSU5JVElBTElTRUQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVQYWNrZXQoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IGdldFJlc3BvbnNlKFVQREFURURfQ09ERSwgVVBEQVRFRF9OQU1FLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnRG9jdW1lbnQgaW5pdGlhbGlzZWQnLCBmYWxzZSwgZGF0YSwgbnVsbCwgbnVsbCApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZi5yZXNvbHZlKHJlc3BvbnNlKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZi5yZWplY3QoZXJyKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYoaW5zdGFudGlhdGVGcm9tID09IEZST01fREVGSU5JVElPTil7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYW8uZ2V0KGRvY3VtZW50SWQpLmRvbmUoZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2V0SWQgPSBpbmRpY2F0b3JNb2RlbC5kZWZhdWx0TW9kZWwuc2V0SWQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZlcnNpb24gPSAgSlNPTi54cGF0aChcIi9pbmRpY2F0b3JzW3NldElkIGVxICdcIisgc2V0SWQgK1wiJ10vdmVyc2lvblwiLGFwcC5TQ09QRS5BUFBfQ09ORklHLHt9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNldE1vZGVsSWQ9IHNldElkKydfJyt2ZXJzaW9uKydfRU5UUlknO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYW8uZ2V0KHNldE1vZGVsSWQpLmRvbmUoZnVuY3Rpb24oc2V0TW9kZWwpe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGVmaW5pdGlvbk1vZGVsID0gZXZhbCgnc2V0TW9kZWwubW9kZWwucGVuZGluZy5kYXRhLicrc2V0SWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5tb2RlbC5wZW5kaW5nLmRhdGFbc2V0SWRdID0gZGVmaW5pdGlvbk1vZGVsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5tb2RlbC5wZW5kaW5nLnN0YXR1cyA9IEVOVFJZX1NUQVRVU19EQVRBX0lOSVRJQUxJU0VEO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZVBhY2tldChkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IGdldFJlc3BvbnNlKFVQREFURURfQ09ERSwgVVBEQVRFRF9OQU1FLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdEb2N1bWVudCBpbml0aWFsaXNlZCcsIGZhbHNlLCBkYXRhLCBudWxsLCBudWxsIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZi5yZXNvbHZlKHJlc3BvbnNlKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5mYWlsKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZi5yZWplY3QoZXJyKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYoaW5zdGFudGlhdGVGcm9tID09IEZST01fQVVUSE9SSVNFRCl7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYW8uZ2V0KGRvY3VtZW50SWQpLmRvbmUoZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2V0SWQgPSBpbmRpY2F0b3JNb2RlbC5kZWZhdWx0TW9kZWwuc2V0SWQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZlcnNpb24gPSAgSlNPTi54cGF0aChcIi9pbmRpY2F0b3JzW3NldElkIGVxICdcIisgc2V0SWQgK1wiJ10vdmVyc2lvblwiLGFwcC5TQ09QRS5BUFBfQ09ORklHLHt9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFwcHJvdmVkTW9kZWxJZD0gZG9jdW1lbnRJZCsnOmFwcHJvdmVkJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGFvLmdldChhcHByb3ZlZE1vZGVsSWQpLmRvbmUoZnVuY3Rpb24oYXBwcm92ZWRNb2RlbCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWF4X3NlcSA9ICBKU09OLnhwYXRoKCdtYXgoL21vZGVsL2FwcHJvdmVkL3NlcSknLGFwcHJvdmVkTW9kZWwse30pWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxhc3RBcHByb3ZlZE1vZGVsID0gSlNPTi54cGF0aCgnL21vZGVsL2FwcHJvdmVkWy4vc2VxID0gJysgbWF4X3NlcSArJ10nLGFwcHJvdmVkTW9kZWwse30pWzBdICAgIDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5ld01vZGVsID0gIGV2YWwoJ2xhc3RBcHByb3ZlZE1vZGVsLmRhdGEuJytzZXRJZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLm1vZGVsLnBlbmRpbmcuZGF0YVtzZXRJZF0gPSBuZXdNb2RlbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEubW9kZWwucGVuZGluZy5zdGF0dXMgPSBFTlRSWV9TVEFUVVNfREFUQV9JTklUSUFMSVNFRDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVQYWNrZXQoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBnZXRSZXNwb25zZShVUERBVEVEX0NPREUsIFVQREFURURfTkFNRSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnRG9jdW1lbnQgaW5pdGlhbGlzZWQnLCBmYWxzZSwgZGF0YSwgbnVsbCwgbnVsbCApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWYucmVzb2x2ZShyZXNwb25zZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuZmFpbCgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24oZXJyKXtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWYucmVqZWN0KGVycik7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gZ2V0UmVzcG9uc2UoU0VSVkVSX0VSUk9SX0NPREUsIFNFUlZFUl9FUlJPUl9OQU1FLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdJbnB1dCBzZXF1ZW5jZSBzaG91bGQgYmUgZXF1YWwgdG8gcGVuZGluZyBzZXF1ZW5jZS4nLCB0cnVlLCBudWxsLCBudWxsLCBudWxsICk7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWYucmVzb2x2ZShyZXNwb25zZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBnZXRSZXNwb25zZShTRVJWRVJfRVJST1JfQ09ERSwgU0VSVkVSX0VSUk9SX05BTUUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1N0YXR1cyBpcyBub3QgaW4gJysgRU5UUllfU1RBVFVTX0lOSVRJQUxJU0VEKyAnIHN0YXRlLicsIHRydWUsIG51bGwsIG51bGwsIG51bGwgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZi5yZXNvbHZlKHJlc3BvbnNlKTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpe1xuXG4gICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gZ2V0UmVzcG9uc2UoZXJyLnN0YXR1cywgZXJyLm5hbWUsIGVyci5tZXNzYWdlLCB0cnVlLCBudWxsLCBudWxsLCBudWxsKTsgXG4gICAgICAgICAgICAgICAgZGVmLnJlc29sdmUocmVzcG9uc2UpO1xuXG4gICAgICAgICAgICB9KTtcblxuXG5cbiAgICByZXR1cm4gZGVmO1xuXG59O1xuXG4vKiogXG4gKiBSZXByZXNlbnRzIHRoZSB1cGRhdGUgZnVuY3Rpb24gZnVuY3Rpb24uXG4gKiBVcGR0YXRlcyB0aGUgY3VycmVudCBkb2N1bWVudCBwZW5kaW5nIHdpdGggaW5wdXQgY3VzdG9tTW9kZWwgb2JqZWN0LlxuICogUHJvY2VzcyBhbGwgcnVsZXMsIGF0dGFjaG1lbnRzIGV0Yy5cbiAqIFVwZGF0ZWQgc3RhdHVzIHRvIFVQREFURUQgb3IgUGVuZGluZ1J1bGVzIGlmIHRoZXJlIGFyZSBhbnkgc2VydmVyIHJ1bGVzXG4gKiBAbWV0aG9kXG4gKiBAcGFyYW0ge3N0cmluZ30gZG9jdW1lbnRJZCAtIGRvY3VtZW50IGlkIHdoaWNoIG5lZWRzIHRvIGJlIGluaXRpYWxpc2VkXG4gKiBAcGFyYW0ge29iamVjdH0gaW5kaWNhdG9yTW9kZWwgLSB2aWV3TW9kZWwgb2YgaW5kaWNhdG9yXG5cbiBcbiAqIEBhdXRob3IgSGFzYW4gQWJiYXNcbiAqIEB2ZXJzaW9uIDEuMC4wXG4gKlxuICogQGV4YW1wbGUgXG4gKiB2YXIgZ2F0ZWtlZXBlciA9IG5ldyBHSygpO1xuICogZ2F0ZWtlZWVyLnVwZGF0ZSgnYWJjMTYxJyx2aWV3TW9kZWwpXG4gKlxuICogQHJldHVybiB7T2JqZWN0fSBQcm9taXNlIE9iamVjdCB3aXRoIHJlc3Bvc2UgT2JqZWN0XG4gKlxuICovXG5cbkdLLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbihkb2N1bWVudElkLGluZGljYXRvck1vZGVsKXtcbiAgICBcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIGRlZiA9IG5ldyAkLkRlZmVycmVkKCk7XG5cbiAgICB2YXIgcHJvY2Vzc0FsbFJ1bGVzID0gXG4gICAgICAgIGZ1bmN0aW9uKGluZGV4LCBkb2N1bWVudElkLCBpbmRpY2F0b3JNb2RlbCwgY29uZmlnRG9jLCBydWxlUmVzcG9uc2UsIGRlZl9wcm9jZXNzUnVsZXMpe1xuXG4gICAgICAgICAgICB2YXIgcnVsZU9iaiA9IGNvbmZpZ0RvYy5ydWxlc1tpbmRleF07ICAgXG4gICAgICAgICAgICB2YXIgZXhlY3V0ZUF0ID0gcnVsZU9iai5leGVjdXRlQXQ7XG4gICAgICAgICAgICB2YXIgaWQgPSBydWxlT2JqLmlkO1xuICAgICAgICAgICAgdmFyIHNlcSA9IHJ1bGVPYmouc2VxO1xuICAgICAgICAgICAgdmFyIHR5cGUgPSBydWxlT2JqLmV4ZWN1dGVSdWxlLnJ1bGVUeXBlO1xuXG4gICAgICAgICAgICBpZihleGVjdXRlQXQgPT0gJ2xvY2FsJyl7XG5cbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICd1cGRhdGUnOiBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc291cmNlID0gcnVsZU9iai5leGVjdXRlUnVsZS5wYXJhbXMuc291cmNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdHIgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IodmFyIG9sPTA7IG9sPHJ1bGVPYmouZXhlY3V0ZVJ1bGUucGFyYW1zLnRhcmdldC5sZW5ndGg7IG9sKyspe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YXJnZXRJdGVtID0gcnVsZU9iai5leGVjdXRlUnVsZS5wYXJhbXMudGFyZ2V0W29sXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhcmdldFR5cGUgPSB0YXJnZXRJdGVtLnR5cGU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YXJnZXROYW1lID0gdGFyZ2V0SXRlbS5uYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih0YXJnZXRUeXBlID09ICd2YXJpYWJsZScpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ciAgPSBzdHIgKyBldmFsKFwiaW5kaWNhdG9yTW9kZWwuY3VzdG9tTW9kZWwuXCIraW5kaWNhdG9yTW9kZWwuZGVmYXVsdE1vZGVsLnNldElkKCkrJy4nKyB0YXJnZXROYW1lKycoKScpKyAnICc7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyICA9IHN0ciArIHRhcmdldE5hbWUgKyAnICc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYW8uZ2V0KGRvY3VtZW50SWQpLmRvbmUoZnVuY3Rpb24ob2JqZWN0KXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihzb3VyY2Uuc3Vic3RyaW5nKDAsIDQpID09ICdkb2M6Jyl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmFsKCdvYmplY3QuJysgc291cmNlLnN1YnN0cmluZyhzb3VyY2UubGVuZ3RoLCA0KSArJz0gc3RyOycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZhbCgnb2JqZWN0Lm1vZGVsLnBlbmRpbmcuZGF0YS4nK2luZGljYXRvck1vZGVsLmRlZmF1bHRNb2RlbC5zZXRJZCgpKycuJytzb3VyY2UrJz0gc3RyOycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYW8uc2F2ZShvYmplY3QpLmRvbmUoZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ1bGVSZXNwb25zZS5ydWxlU3RhdHVzID0gJ1JVTEVfQ09NUExFVEUnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihpbmRleCA9PSBjb25maWdEb2MucnVsZXMubGVuZ3RoIC0gMSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZl9wcm9jZXNzUnVsZXMucmVzb2x2ZShydWxlUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzQWxsUnVsZXMoaW5kZXgrMSwgZG9jdW1lbnRJZCwgaW5kaWNhdG9yTW9kZWwsIGNvbmZpZ0RvYywgcnVsZVJlc3BvbnNlLGRlZl9wcm9jZXNzUnVsZXMpOyAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uKGVycil7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVsZVJlc3BvbnNlLnJ1bGVTdGF0dXMgPSAnUlVMRV9FUlJPUic7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2luaXRpYWxpc2UnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAndW5pcXVlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vVE9ETzogaW1wbGVtZW50IHNlcnZlciBzaWRlIHBvc3QgYWN0aW9ucyAgIFxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGRhby5nZXQoZG9jdW1lbnRJZCkuZG9uZShmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5tb2RlbC5wZW5kaW5nLnByb2Nlc3NpbmdTdGF0dXMuc2VxID0gc2VxO1xuICAgICAgICAgICAgICAgICAgICBkYXRhLm1vZGVsLnBlbmRpbmcucHJvY2Vzc2luZ1N0YXR1cy5ydWxlU3RhdHVzID0gUFJPQ0VTU0lOR19TVEFUVVNfU0VSVkVSX1JVTEVTO1xuICAgICAgICAgICAgICAgICAgICBkYW8uc2F2ZShkYXRhKS5kb25lKGZ1bmN0aW9uKG9iamVjdCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgcnVsZVJlc3BvbnNlLnJ1bGVTdGF0dXMgPSAnUlVMRV9TRVJWRVInO1xuICAgICAgICAgICAgICAgICAgICAgICAgIGRlZl9wcm9jZXNzUnVsZXMucmVzb2x2ZShydWxlUmVzcG9uc2UpO1xuXG4gICAgICAgICAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24oZXJyKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZXJyb3IgZnVuY3Rpb24gaW4gUFJPQ0VTU0lOR19TVEFUVVNfU0VSVkVSX1JVTEVTJysgZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZGVmX3Byb2Nlc3NSdWxlcztcbiAgICB9XG5cbiAgICBkYW8uZ2V0KGRvY3VtZW50SWQpLmRvbmUoZnVuY3Rpb24oZG9jKXtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgaWYoaW5kaWNhdG9yTW9kZWwubW9kZWxFcnJvcnMoKS5sZW5ndGggPiAwKXtcblxuICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gZ2V0UmVzcG9uc2UoUFJFQ09ORElUSU9OX0ZBSUxFRF9DT0RFLCBQUkVDT05ESVRJT05fRkFJTEVEX05BTUUsXG4gICAgICAgICAgICAgICAgICAgICdUaGVyZSBhcmUgJytpbmRpY2F0b3JNb2RlbC5tb2RlbEVycm9ycygpLmxlbmd0aCsgJyBlcnJvcnMgb24gZm9ybS4gUGxlYXNlIHJlc29sdmUgZmlyc3QuJywgdHJ1ZSwgbnVsbCwgbnVsbCwgbnVsbCApO1xuICAgICAgICAgICAgZGVmLnJlamVjdChyZXNwb25zZSk7XG5cbiAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgaWYoZG9jLm1vZGVsLnBlbmRpbmcuc3RhdHVzID09IEVOVFJZX1NUQVRVU19EQVRBX0lOSVRJQUxJU0VEIHx8IGRvYy5tb2RlbC5wZW5kaW5nLnN0YXR1cyA9PSBFTlRSWV9TVEFUVVNfVVBEQVRFRCl7XG5cblxuICAgICAgICAgICAgICAgIHZhciBtb2RlbCA9IEpTT04ucGFyc2Uoa28udG9KU09OKGV2YWwoJ2luZGljYXRvck1vZGVsLmN1c3RvbU1vZGVsLicraW5kaWNhdG9yTW9kZWwuZGVmYXVsdE1vZGVsLnNldElkKCkpLCBmdW5jdGlvbihrZXksIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKGtleSA9PT0gJ19fa29fbWFwcGluZ19fJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB9IFxuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB2YXIgdmVyc2lvbj0nJztcblxuICAgICAgICAgICAgICAgIGlmKGluZGljYXRvck1vZGVsLmN1c3RvbU1vZGVsLnNldElkKCkgPT0gUFJPRklMRV9TRVRfSUQpXG4gICAgICAgICAgICAgICAgeyBcbiAgICAgICAgICAgICAgICAgICAgdmVyc2lvbiA9ICdWMS4wJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHsgXG4gICAgICAgICAgICAgICAgICAgIHZlcnNpb24gPSAgSlNPTi54cGF0aChcIi9pbmRpY2F0b3JzW3NldElkIGVxICdcIitpbmRpY2F0b3JNb2RlbC5jdXN0b21Nb2RlbC5zZXRJZCgpK1wiJ10vdmVyc2lvblwiLGFwcC5TQ09QRS5BUFBfQ09ORklHLHt9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIGFsbCBhdHRhY2htZW50c1xuICAgICAgICAgICAgICAgIHZhciBmaWxlcyA9IEpTT04ueHBhdGgoXCIvLypbZmlsZURhdGEgYW5kIGlzQ2hhbmdlZCBlcSAndHJ1ZSddXCIsbW9kZWwse30pO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHZhciBhdHRhY2hlbWVudHNUb1Byb2Nlc3MgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgZm9yKHZhciBvbD0wO29sPGZpbGVzLmxlbmd0aDtvbCsrKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaWxlc09iaj1maWxlc1tvbF07ICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihmaWxlc09iai5taW1lID09ICdpbWFnZS9qcGVnJyB8fCBmaWxlc09iai5taW1lID09ICdpbWFnZS9wbmcnKVxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dGFjaGVtZW50c1RvUHJvY2Vzcy5wdXNoKHsgXCJkYXRhXCI6IGZpbGVzT2JqLmZpbGVEYXRhLnN1YnN0cmluZyhmaWxlc09iai5maWxlRGF0YS5pbmRleE9mKCdiYXNlNjQnKSs3KSwgXCJpZFwiOiBmaWxlc09iai51dWlkICwgXCJtaW1lXCI6IGZpbGVzT2JqLm1pbWUgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9ICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNle1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dGFjaGVtZW50c1RvUHJvY2Vzcy5wdXNoKHsgXCJkYXRhXCI6IGZpbGVzT2JqLmZpbGVEYXRhLCBcImlkXCI6IGZpbGVzT2JqLnV1aWQgLCBcIm1pbWVcIjogZmlsZXNPYmoubWltZSB9KTsgXG4gICAgICAgICAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlc09iai5maWxlRGF0YSA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlc09iai5pc0NoYW5nZWQgPSAnZmFsc2UnO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBhbGxGaWxlcyA9IEpTT04ueHBhdGgoXCIvLypbZmlsZURhdGEgbmUgJycgYW5kIHV1aWQgbmUgJyddXCIsbW9kZWwse30pO1xuICAgICAgICAgICAgICAgICAgICBmb3IodmFyIG9sPTA7b2w8YWxsRmlsZXMubGVuZ3RoO29sKyspe1xuICAgICAgICAgICAgICAgICAgICAgICAgYWxsRmlsZXNbb2xdLmZpbGVEYXRhID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgfSAgIFxuXG4gICAgICAgICAgICAgICAgdmFyIHNhdmVBdHRhY2htZW50cyA9IGZ1bmN0aW9uKGRhdGEsIGxvb3ApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgZGFvLnNhdmVBdHRhY2htZW50KGRhdGEuaWQsIGRhdGEucmV2LCBhdHRhY2hlbWVudHNUb1Byb2Nlc3NbbG9vcF0uZGF0YSwgXG4gICAgICAgICAgICAgICAgICAgICAgICBhdHRhY2hlbWVudHNUb1Byb2Nlc3NbbG9vcF0ubWltZSwgYXR0YWNoZW1lbnRzVG9Qcm9jZXNzW2xvb3BdLmlkKVxuICAgICAgICAgICAgICAgICAgICAuZG9uZShmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdHRhY2hlbWVudHNUb1Byb2Nlc3MubGVuZ3RoID4gKGxvb3AgKyAxKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVBdHRhY2htZW50cyhlLCBsb29wICsgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiY2FuIG5vdCBzYXZlZCBhdHRhY2hlbW50IFwiICsgZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB2YXIgcG9zdFNhdmUgPSBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgaW5kaWNhdG9yTW9kZWwuZGVmYXVsdE1vZGVsLmF0b21JZChkb2N1bWVudElkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGF0dGFjaGVtZW50c1RvUHJvY2Vzcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzYXZlQXR0YWNobWVudHMoZGF0YSwgMCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gZ2V0UmVzcG9uc2UoVVBEQVRFRF9DT0RFLCBVUERBVEVEX05BTUUsJ0RvY3VtZW50IHVwZGF0ZWQnLCBmYWxzZSwgZGF0YSwgbnVsbCwgbnVsbCApXG4gICAgICAgICAgICAgICAgICAgIGRlZi5yZXNvbHZlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgdmFyIHNhdmVQYWNrZXQgPSBmdW5jdGlvbihmaW5hbFBrdCl7XG5cbiAgICAgICAgICAgICAgICAgICAgLy92YWxpZGF0ZSBvbmxpbmUgaGVyZVxuICAgICAgICAgICAgICAgICAgICBkYW8uc2F2ZShmaW5hbFBrdCkuZG9uZShwb3N0U2F2ZSkuZmFpbChmdW5jdGlvbihlcnIpe1xuICAgICAgICAgICAgICAgICAgICAgICAgYXBwLnNob3dNZXNzYWdlKFwiVW5hYmxlIHRvIHNhdmUgY2hhbmdlcyBkdWUgdG8gdmVyc2lvbiBjb25mbGljdC4gUGxlYXNlIHJlbG9hZCB0aGUgZm9ybSB0byBzZWUgdGhlIHJlY2VudCB1cGRhdGVzLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmZlcmVkLnJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBkYW8uZ2V0KGluZGljYXRvck1vZGVsLmN1c3RvbU1vZGVsLnNldElkKCkrICdfJyt2ZXJzaW9uK1wiX2NvbmZpZ1wiKS5kb25lKGZ1bmN0aW9uKGNvbmZpZ0RvYyl7XG5cbiAgICAgICAgICAgICAgICAgICAgZG9jLm1vZGVsLnBlbmRpbmcuZGF0YVtpbmRpY2F0b3JNb2RlbC5jdXN0b21Nb2RlbC5zZXRJZCgpXSA9IG1vZGVsO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vZG9jLm1vZGVsLnBlbmRpbmcuc3RhdHVzID0gRU5UUllfU1RBVFVTX1BFTkRJTkc7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYoY29uZmlnRG9jLm1vZGVyYXRpb24gIT0gdW5kZWZpbmVkICYmIGNvbmZpZ0RvYy5tb2RlcmF0aW9uLnJlcXVpcmVkID09IHRydWUpXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5jb250cm9sLmRyYWZ0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSB1cGRhdGVkIGRhdGUgZmllbGRcbiAgICAgICAgICAgICAgICAgICAgZG9jLnVwZGF0ZWQgPSBtb21lbnQoKS5mb3JtYXQoKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBjb250cmlidXRvcnMgbGlzdFxuICAgICAgICAgICAgICAgICAgICBkb2MuY29udHJpYnV0b3JzLnB1c2goe1wibmFtZVwiOiBMT0NBTF9TRVRUSU5HUy5TRVNTSU9OLmZpcnN0TmFtZSArIFwiIFwiICsgTE9DQUxfU0VUVElOR1MuU0VTU0lPTi5sYXN0TmFtZSxcInVzZXJJZFwiOiBMT0NBTF9TRVRUSU5HUy5TVUJTQ1JJUFRJT05TLnVzZXJJZCwgXCJ1c2VybmFtZVwiOiBMT0NBTF9TRVRUSU5HUy5TVUJTQ1JJUFRJT05TLnVzZXJuYW1lfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZG9jLm1vZGVsLnBlbmRpbmcudXNlciA9IHtcIm5hbWVcIjogTE9DQUxfU0VUVElOR1MuU0VTU0lPTi5maXJzdE5hbWUgKyBcIiBcIiArIExPQ0FMX1NFVFRJTkdTLlNFU1NJT04ubGFzdE5hbWUsXCJ1c2VySWRcIjogTE9DQUxfU0VUVElOR1MuU1VCU0NSSVBUSU9OUy51c2VySWQsIFwidXNlcm5hbWVcIjogTE9DQUxfU0VUVElOR1MuU1VCU0NSSVBUSU9OUy51c2VybmFtZX07XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgLy8gU2F2ZSB0aGUgZG9jdW1lbnQgaW4gdGhlIGRhdGFiYXNlIGkuZS4gbG9jYWwgUG91Y2hEQiBvciBDb3VjaGJhc2UgTGl0ZVxuICAgICAgICAgICAgICAgICAgICBkb2Muc291cmNlID0gXCJyZW1vdGVcIjtcblxuICAgICAgICAgICAgICAgICAgICBpZihjb25maWdEb2MucnVsZXMubGVuZ3RoID4gMCl7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5tb2RlbC5wZW5kaW5nLnN0YXR1cyA9IEVOVFJZX1NUQVRVU19QRU5ESU5HX1JVTEVTO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGFvLnNhdmUoZG9jKS5kb25lKGZ1bmN0aW9uKGRhdGEpe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRlZl9wcm9jZXNzUnVsZXMgPSBuZXcgJC5EZWZlcnJlZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NBbGxSdWxlcygwLGRvY3VtZW50SWQsIGluZGljYXRvck1vZGVsLCBjb25maWdEb2Mse1wicnVsZVN0YXR1c1wiOlwiXCJ9LGRlZl9wcm9jZXNzUnVsZXMpLmRvbmUoZnVuY3Rpb24oaW5Nb2RlbCl7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoaW5Nb2RlbC5ydWxlU3RhdHVzID09ICdSVUxFX0NPTVBMRVRFJyl7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhby5nZXQoZG9jdW1lbnRJZCkuZG9uZShmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLm1vZGVsLnBlbmRpbmcucHJvY2Vzc2luZ1N0YXR1cy5zZXEgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLm1vZGVsLnBlbmRpbmcucHJvY2Vzc2luZ1N0YXR1cy5ydWxlU3RhdHVzID0gJyc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5tb2RlbC5wZW5kaW5nLnN0YXR1cyA9IEVOVFJZX1NUQVRVU19VUERBVEVEO1xuXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1RPRE86IEZpeCBFTlRSWV9TVEFUVVNfUkVBRFlfVE9fU1VCTUlUIGluIGRvY3VtZW50LiBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihhcHAucHJvY2Vzc0lkICE9IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcm9jZXNzID0gSlNPTi54cGF0aChcIi9wcm9jZXNzZXNbc3ViUHJvY2Vzc0lkIGVxICdcIithcHAucHJvY2Vzc0lkK1wiJ11cIixkYXRhLHt9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHByb2Nlc3MubGVuZ3RoID4gMClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc1swXS5zdGF0dXMgPSBFTlRSWV9TVEFUVVNfUkVBRFlfVE9fU1VCTUlUOy8vIGNoZWNrIGhlcmUgdGhlIGluZGV4XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXZlUGFja2V0KGRhdGEpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uKGVycm9yKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWYucmVqZWN0KCdFTlRSWV9TVEFUVVNfVVBEQVRFRCBmYWlsZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZihpbk1vZGVsLnJ1bGVTdGF0dXMgPT0gJ1JVTEVfU0VSVkVSJyl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdkZXBlbmRlbnQgb25zZXJ2ZXIgcnVsZScpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZihpbk1vZGVsLnJ1bGVTdGF0dXMgPT0gJ1JVTEVfRVJST1InKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3J1bGUgZXJyb3IgZnJvbSBzb21ld2hlcmUnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uKGVycm9yKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWYucmVqZWN0KCdwcm9jZXNzQWxsUnVsZXMgZmFpbCBwcm9taXNlIGNhc2UgZmFpbGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24oZXJyb3Ipe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZi5yZWplY3QoJ0VOVFJZX1NUQVRVU19QRU5ESU5HX1JVTEVTIGZhaWxlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZGFvLmdldChkb2N1bWVudElkKS5kb25lKGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEubW9kZWwucGVuZGluZy5zdGF0dXMgPSBFTlRSWV9TVEFUVVNfVVBEQVRFRDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXZlUGFja2V0KGRhdGEpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uKGVycm9yKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWYucmVqZWN0KCdFTlRSWV9TVEFUVVNfVVBEQVRFRCBmYWlsZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24oZXJyKXtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBnZXRSZXNwb25zZShlcnIuc3RhdHVzLCBlcnIubmFtZSwgZXJyLm1lc3NhZ2UsIHRydWUsIG51bGwsIG51bGwsIG51bGwpOyBcbiAgICAgICAgICAgICAgICAgICAgZGVmLnJlamVjdChyZXNwb25zZSk7ICAgICAgIFxuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgXG5cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IGdldFJlc3BvbnNlKFNFUlZFUl9FUlJPUl9DT0RFLCBTRVJWRVJfRVJST1JfTkFNRSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnU3RhdHVzIGlzIG5vdCBpbiAnKyBFTlRSWV9TVEFUVVNfREFUQV9JTklUSUFMSVNFRCArJyBvciAnKyBFTlRSWV9TVEFUVVNfVVBEQVRFRCArICcgc3RhdGUuJywgdHJ1ZSwgbnVsbCwgbnVsbCwgbnVsbCApO1xuICAgICAgICAgICAgICAgIGRlZi5yZXNvbHZlKHJlc3BvbnNlKTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICB9KS5mYWlsKGZ1bmN0aW9uKGVycil7XG5cbiAgICAgICAgICAgIHZhciByZXNwb25zZSA9IGdldFJlc3BvbnNlKGVyci5zdGF0dXMsIGVyci5uYW1lLCBlcnIubWVzc2FnZSwgdHJ1ZSwgbnVsbCwgbnVsbCwgbnVsbCk7IFxuICAgICAgICAgICAgZGVmLnJlamVjdChyZXNwb25zZSk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gZGVmO1xuICAgIH07XG5cbi8qKiBcbiAqIFJlcHJlc2VudHMgdGhlIGF1dGhvcmlzZSAgZnVuY3Rpb24uXG4gKiBVcGR0YXRlcyB0aGUgY3VycmVudCBkb2N1bWVudCBwZW5kaW5nIHdpdGggc3RhdHVzIEF1dGhvcmlzZWQuXG4gKiBDb3BpZWQgdGhlIGRhdGEgdG8gYXV0aG9yaXNlZCBhcnJheSBvZiBhdXRob3Jpc2VkIGRvY3VtZW50LlxuICogQG1ldGhvZFxuICogQHBhcmFtIHtzdHJpbmd9IGRvY3VtZW50SWQgLSBkb2N1bWVudCBpZCB3aGljaCBuZWVkcyB0byBiZSBpbml0aWFsaXNlZFxuIFxuICogQGF1dGhvciBIYXNhbiBBYmJhc1xuICogQHZlcnNpb24gMS4wLjBcbiAqXG4gKiBAZXhhbXBsZSBcbiAqIHZhciBnYXRla2VlcGVyID0gbmV3IEdLKCk7XG4gKiBnYXRla2VlZXIuYXV0aG9yaXNlKCdhYmMxNjEnKVxuICpcbiAqIEByZXR1cm4ge09iamVjdH0gUHJvbWlzZSBPYmplY3Qgd2l0aCByZXNwb3NlIE9iamVjdFxuICpcbiAqL1xuXG5HSy5wcm90b3R5cGUuYXV0aG9yaXNlID0gZnVuY3Rpb24oZG9jdW1lbnRJZCl7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciBkZWYgPSBuZXcgJC5EZWZlcnJlZCgpO1xuICAgIGlmKGRvY3VtZW50SWQgIT0gbnVsbCAmJiAgZG9jdW1lbnRJZCAhPSB1bmRlZmluZWQgJiYgZG9jdW1lbnRJZCAhPSAnJyl7XG5cbiAgICAgICAgZGFvLmdldChkb2N1bWVudElkKS5kb25lKGZ1bmN0aW9uKGRhdGEpe1xuXG5cbiAgICAgICAgICAgIGlmKGRhdGEubW9kZWwucGVuZGluZy5zdGF0dXMgPT0gRU5UUllfU1RBVFVTX1VQREFURUQpe1xuXG4gICAgICAgICAgICAgICAgdmFyIHNhdmVEb2MgPSBmdW5jdGlvbihkb2Mpe1xuICAgICAgICAgICAgICAgICAgICAgICBkYW8uc2F2ZShkb2MpLmRvbmUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24ocyl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICkuZmFpbChmdW5jdGlvbihlcnIpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZi5yZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH07XG5cblxuICAgICAgICAgICAgICAgIHZhciBzZXRJZCA9IGRhdGEuY2F0ZWdvcnkudGVybTtcbiAgICAgICAgICAgICAgICB2YXIgcGF0aCA9IGRhdGEubW9kZWwucGVuZGluZztcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IGV2YWwocGF0aCk7XG4gICAgICAgICAgICAgICAgZGF0YS5tb2RlbC5wZW5kaW5nLnN0YXR1cyA9IEVOVFJZX1NUQVRVU19BVVRIT1JJU0VEO1xuICAgICAgICAgICAgICAgIHNhdmVEb2MoZGF0YSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgYXBwcm92ZV9kb2NfaWQgPSBkb2N1bWVudElkKyc6YXBwcm92ZWQnO1xuXG4gICAgICAgICAgICAgICAgZGFvLmdldChhcHByb3ZlX2RvY19pZCkuZG9uZShmdW5jdGlvbihhcHByb3ZlRGF0YSl7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBhcHByb3ZlRGF0YS5tb2RlbC5hcHByb3ZlZC5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICBzYXZlRG9jKGFwcHJvdmVEYXRhKTtcblxuXG4gICAgICAgICAgICAgICAgICAgIGRlZi5yZXNvbHZlKGFwcHJvdmVEYXRhKTtcbiAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpe1xuICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gZ2V0UmVzcG9uc2UoQkFEX1JFUVVFU1RfQ09ERSwgQkFEX1JFUVVFU1RfTkFNRSwnU3RhdHVzIG5vdCBpbiB1cGRhdGVkIHN0YXRlJyx0cnVlLG51bGwsbnVsbCxudWxsIClcbiAgICAgICAgICAgICAgICBkZWYucmVqZWN0KHJlc3BvbnNlKTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBcblxuICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uKGVycil7XG5cbiAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gZ2V0UmVzcG9uc2UoZXJyLnN0YXR1cywgZXJyLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnIubWVzc2FnZSwgdHJ1ZSwgbnVsbCwgbnVsbCwgbnVsbCk7IFxuICAgICAgICAgICAgZGVmLnJlc29sdmUocmVzcG9uc2UpO1xuXG4gICAgICAgIH0pO1xuXG4gICAgfWVsc2V7XG5cbiAgICAgICAgdmFyIHJlc3BvbnNlID0gZ2V0UmVzcG9uc2UoQkFEX1JFUVVFU1RfQ09ERSwgQkFEX1JFUVVFU1RfTkFNRSwnRG9jdW1lbnQgSUQgaXMgYmxhbmsnLHRydWUsbnVsbCxudWxsLG51bGwgKVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgZGVmLnJlamVjdChyZXNwb25zZSk7XG5cbiAgICB9XG5cbiAgICByZXR1cm4gZGVmO1xuICAgXG59O1xuXG4vKiogXG4gKiBSZXByZXNlbnRzIHRoZSByZWplY3QgIGZ1bmN0aW9uLlxuICogVXBkdGF0ZXMgdGhlIGN1cnJlbnQgZG9jdW1lbnQgcGVuZGluZyB3aXRoIHN0YXR1cyBSZWpldGNlZC5cbiAqIENvcGllZCB0aGUgZGF0YSB0byBhdXRob3Jpc2VkIGFycmF5IG9mIHJlamVjdGVkIGRvY3VtZW50LlxuICogQG1ldGhvZFxuICogQHBhcmFtIHtzdHJpbmd9IGRvY3VtZW50SWQgLSBkb2N1bWVudCBpZCB3aGljaCBuZWVkcyB0byBiZSBpbml0aWFsaXNlZFxuIFxuICogQGF1dGhvciBIYXNhbiBBYmJhc1xuICogQHZlcnNpb24gMS4wLjBcbiAqXG4gKiBAZXhhbXBsZSBcbiAqIHZhciBnYXRla2VlcGVyID0gbmV3IEdLKCk7XG4gKiBnYXRla2VlZXIucmVqZWN0KCdhYmMxNjEnKVxuICpcbiAqIEByZXR1cm4ge09iamVjdH0gUHJvbWlzZSBPYmplY3Qgd2l0aCByZXNwb3NlIE9iamVjdFxuICpcbiAqL1xuXG5HSy5wcm90b3R5cGUucmVqZWN0ID0gZnVuY3Rpb24oZG9jdW1lbnRJZCl7XG4gICAgXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciBkZWYgPSBuZXcgJC5EZWZlcnJlZCgpO1xuICAgIGlmKGRvY3VtZW50SWQgIT0gbnVsbCAmJiAgZG9jdW1lbnRJZCAhPSB1bmRlZmluZWQgJiYgZG9jdW1lbnRJZCAhPSAnJyl7XG5cbiAgICAgICAgXG5cbiAgICAgICAgZGFvLmdldChkb2N1bWVudElkKS5kb25lKGZ1bmN0aW9uKGRhdGEpe1xuXG4gICAgICAgICAgICBpZihkYXRhLm1vZGVsLnBlbmRpbmcuc3RhdHVzID09IEVOVFJZX1NUQVRVU19VUERBVEVEKXtcblxuICAgICAgICAgICAgICAgIHZhciBzYXZlRG9jID0gZnVuY3Rpb24oZG9jKXtcbiAgICAgICAgICAgICAgICAgICAgICAgZGFvLnNhdmUoZG9jKS5kb25lKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKHMpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgKS5mYWlsKGZ1bmN0aW9uKGVycil7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmLnJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfTtcblxuXG4gICAgICAgICAgICAgICAgdmFyIHNldElkID0gZGF0YS5jYXRlZ29yeS50ZXJtO1xuICAgICAgICAgICAgICAgIHZhciBpdGVtID0gZXZhbCgnZGF0YS5tb2RlbC5wZW5kaW5nLmRhdGEnK3NldElkKTtcblxuICAgICAgICAgICAgICAgIGRhdGEubW9kZWwucGVuZGluZy5zdGF0dXMgPSBFTlRSWV9TVEFUVVNfUkVKRUNURUQ7XG4gICAgICAgICAgICAgICAgc2F2ZURvYyhkYXRhKTtcblxuICAgICAgICAgICAgICAgIHZhciByZWplY3RlZF9kb2NfaWQgPSBkb2N1bWVudElkKyc6cmVqZWN0ZWQnO1xuXG4gICAgICAgICAgICAgICAgZGFvLmdldChyZWplY3RlZF9kb2NfaWQpLmRvbmUoZnVuY3Rpb24ocmVqZWN0ZWREYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdGVkRGF0YS5tb2RlbC5yZWplY3RlZC5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICBzYXZlRG9jKHJlamVjdGVkRGF0YSk7XG5cblxuICAgICAgICAgICAgICAgICAgICBkZWYucmVzb2x2ZShyZWplY3RlZERhdGEpO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uKGVycil7XG4gICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBnZXRSZXNwb25zZShCQURfUkVRVUVTVF9DT0RFLCBCQURfUkVRVUVTVF9OQU1FLCdTdGF0dXMgbm90IGluIHVwZGF0ZWQgc3RhdGUnLHRydWUsbnVsbCxudWxsLG51bGwgKVxuICAgICAgICAgICAgICAgIGRlZi5yZWplY3QocmVzcG9uc2UpO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIFxuXG4gICAgICAgIH0pLmZhaWwoZnVuY3Rpb24oZXJyKXtcblxuICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBnZXRSZXNwb25zZShlcnIuc3RhdHVzLCBlcnIubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVyci5tZXNzYWdlLCB0cnVlLCBudWxsLCBudWxsLCBudWxsKTsgXG4gICAgICAgICAgICBkZWYucmVzb2x2ZShyZXNwb25zZSk7XG5cbiAgICAgICAgfSk7XG5cbiAgICB9ZWxzZXtcblxuICAgICAgICB2YXIgcmVzcG9uc2UgPSBnZXRSZXNwb25zZShCQURfUkVRVUVTVF9DT0RFLCBCQURfUkVRVUVTVF9OQU1FLCdEb2N1bWVudCBJRCBpcyBibGFuaycsdHJ1ZSxudWxsLG51bGwsbnVsbCApXG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICBkZWYucmVqZWN0KHJlc3BvbnNlKTtcblxuICAgIH1cblxuICAgIHJldHVybiBkZWY7XG5cbn07XG5cbnZhciBwcm9jZXNzSW5pdGlhbGlzZVJ1bGUgPSBmdW5jdGlvbihkb2N1bWVudElkLCBydWxlT2JqLCBpbmRpY2F0b3JNb2RlbCl7XG4gICAgXG59O1xuXG52YXIgcHJvY2Vzc1VuaXF1ZVJ1bGUgPSBmdW5jdGlvbihkb2N1bWVudElkLCBydWxlT2JqLCBpbmRpY2F0b3JNb2RlbCl7XG5cbn07XG5cbkdLLnByb3RvdHlwZS51bmxvY2sgPSBmdW5jdGlvbih2YWwpe1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAvLyBVc2UgdGhlIG5hdGl2ZSBQcm9taXNlIGNvbnN0cnVjdG9yXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgIFxuICAgICAgXG5cbiAgICB9KTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gR0s7Il19
